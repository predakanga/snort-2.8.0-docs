<!DOCTYPE HTML>

<!--Converted with LaTeX2HTML 2021.2 (Released July 1, 2021) -->
<HTML lang="en">
<HEAD>
<TITLE>2.1 Preprocessors</TITLE>
<META NAME="description" CONTENT="2.1 Preprocessors">
<META NAME="keywords" CONTENT="snort_manual">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<META NAME="viewport" CONTENT="width=device-width, initial-scale=1.0">
<META NAME="Generator" CONTENT="LaTeX2HTML v2021.2">

<LINK REL="STYLESHEET" HREF="snort_manual.css">

<LINK REL="next" HREF="node12.html">
<LINK REL="previous" HREF="node10.html">
<LINK REL="next" HREF="node12.html">
</HEAD>

<BODY >

<DIV CLASS="navigation"><!--Navigation Panel-->
<A
 HREF="node12.html">
<IMG WIDTH="37" HEIGHT="24" ALT="next" SRC="next.png"></A> 
<A
 HREF="node10.html">
<IMG WIDTH="26" HEIGHT="24" ALT="up" SRC="up.png"></A> 
<A
 HREF="node10.html">
<IMG WIDTH="63" HEIGHT="24" ALT="previous" SRC="prev.png"></A> 
<A ID="tex2html377"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALT="contents" SRC="contents.png"></A>  
<BR>
<B> Next:</B> <A
 HREF="node12.html">2.2 Event Thresholding</A>
<B> Up:</B> <A
 HREF="node10.html">2. Configuring Snort</A>
<B> Previous:</B> <A
 HREF="node10.html">2. Configuring Snort</A>
 &nbsp; <B>  <A ID="tex2html378"
  HREF="node1.html">Contents</A></B> 
<BR>
<BR></DIV>
<!--End of Navigation Panel-->
<!--Table of Child-Links-->
<A ID="CHILD_LINKS"><STRONG>Subsections</STRONG></A>

<UL CLASS="ChildLinks">
<LI><A ID="tex2html379"
  HREF="node11.html#SECTION00311000000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">1</SPAN> Frag3 </A>
<UL>
<LI><A ID="tex2html380"
  HREF="node11.html#SECTION00311100000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">1</SPAN> Frag 3 Configuration</A>
<LI><A ID="tex2html381"
  HREF="node11.html#SECTION00311200000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">2</SPAN> format</A>
<LI><A ID="tex2html382"
  HREF="node11.html#SECTION00311300000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">3</SPAN> Frag 3 Alert Output</A>
</UL>
<BR>
<LI><A ID="tex2html383"
  HREF="node11.html#SECTION00312000000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">2</SPAN> Stream4</A>
<UL>
<LI><A ID="tex2html384"
  HREF="node11.html#SECTION00312100000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN> Stream4 Format</A>
<LI><A ID="tex2html385"
  HREF="node11.html#SECTION00312200000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN> stream4_reassemble Format</A>
<LI><A ID="tex2html386"
  HREF="node11.html#SECTION00312300000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">3</SPAN> Notes</A>
</UL>
<BR>
<LI><A ID="tex2html387"
  HREF="node11.html#SECTION00313000000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">3</SPAN> Flow</A>
<UL>
<LI><A ID="tex2html388"
  HREF="node11.html#SECTION00313100000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">3</SPAN>.<SPAN CLASS="arabic">1</SPAN> Format</A>
<LI><A ID="tex2html389"
  HREF="node11.html#SECTION00313200000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">3</SPAN>.<SPAN CLASS="arabic">2</SPAN> Example Configuration</A>
</UL>
<BR>
<LI><A ID="tex2html390"
  HREF="node11.html#SECTION00314000000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">4</SPAN> Stream5</A>
<UL>
<LI><A ID="tex2html391"
  HREF="node11.html#SECTION00314100000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">1</SPAN> Transport Protocols</A>
<LI><A ID="tex2html392"
  HREF="node11.html#SECTION00314200000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">2</SPAN> Target-Based</A>
<LI><A ID="tex2html393"
  HREF="node11.html#SECTION00314300000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">3</SPAN> Stream API</A>
<LI><A ID="tex2html394"
  HREF="node11.html#SECTION00314400000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">4</SPAN> Anomaly Detection</A>
<LI><A ID="tex2html395"
  HREF="node11.html#SECTION00314500000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">5</SPAN> Stream5 Global Configuration</A>
<LI><A ID="tex2html396"
  HREF="node11.html#SECTION00314600000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">6</SPAN> Stream5 TCP Configuration</A>
<LI><A ID="tex2html397"
  HREF="node11.html#SECTION00314700000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">7</SPAN> Stream5 UDP Configuration</A>
<LI><A ID="tex2html398"
  HREF="node11.html#SECTION00314800000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">8</SPAN> Stream5 ICMP Configuration</A>
<LI><A ID="tex2html399"
  HREF="node11.html#SECTION00314900000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">9</SPAN> Example Configurations</A>
<LI><A ID="tex2html400"
  HREF="node11.html#SECTION003141000000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">10</SPAN> Alerts</A>
</UL>
<BR>
<LI><A ID="tex2html401"
  HREF="node11.html#SECTION00315000000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">5</SPAN> sfPortscan</A>
<UL>
<LI><A ID="tex2html402"
  HREF="node11.html#SECTION00315100000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">5</SPAN>.<SPAN CLASS="arabic">1</SPAN> sfPortscan Configuration</A>
<LI><A ID="tex2html403"
  HREF="node11.html#SECTION00315200000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">5</SPAN>.<SPAN CLASS="arabic">2</SPAN> Format</A>
<LI><A ID="tex2html404"
  HREF="node11.html#SECTION00315300000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">5</SPAN>.<SPAN CLASS="arabic">3</SPAN> sfPortscan Alert Output</A>
<LI><A ID="tex2html405"
  HREF="node11.html#SECTION00315400000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">5</SPAN>.<SPAN CLASS="arabic">4</SPAN> Tuning sfPortscan</A>
</UL>
<BR>
<LI><A ID="tex2html406"
  HREF="node11.html#SECTION00316000000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">6</SPAN> RPC Decode</A>
<UL>
<LI><A ID="tex2html407"
  HREF="node11.html#SECTION00316100000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">6</SPAN>.<SPAN CLASS="arabic">1</SPAN> Format</A>
</UL>
<BR>
<LI><A ID="tex2html408"
  HREF="node11.html#SECTION00317000000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">7</SPAN> Performance Monitor</A>
<UL>
<LI><A ID="tex2html409"
  HREF="node11.html#SECTION00317100000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">7</SPAN>.<SPAN CLASS="arabic">1</SPAN> Examples</A>
</UL>
<BR>
<LI><A ID="tex2html410"
  HREF="node11.html#SECTION00318000000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">8</SPAN> HTTP Inspect </A>
<UL>
<LI><A ID="tex2html411"
  HREF="node11.html#SECTION00318100000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">8</SPAN>.<SPAN CLASS="arabic">1</SPAN> Global Configuration</A>
<LI><A ID="tex2html412"
  HREF="node11.html#SECTION00318200000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">8</SPAN>.<SPAN CLASS="arabic">2</SPAN> Format</A>
<LI><A ID="tex2html413"
  HREF="node11.html#SECTION00318300000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">8</SPAN>.<SPAN CLASS="arabic">3</SPAN> Example Global Configuration</A>
<LI><A ID="tex2html414"
  HREF="node11.html#SECTION00318400000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">8</SPAN>.<SPAN CLASS="arabic">4</SPAN> Server Configuration</A>
<LI><A ID="tex2html415"
  HREF="node11.html#SECTION00318500000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">8</SPAN>.<SPAN CLASS="arabic">5</SPAN> Example Default Configuration</A>
<LI><A ID="tex2html416"
  HREF="node11.html#SECTION00318600000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">8</SPAN>.<SPAN CLASS="arabic">6</SPAN> Example IP Configuration</A>
<LI><A ID="tex2html417"
  HREF="node11.html#SECTION00318700000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">8</SPAN>.<SPAN CLASS="arabic">7</SPAN> Server Configuration Options</A>
<LI><A ID="tex2html418"
  HREF="node11.html#SECTION00318800000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">8</SPAN>.<SPAN CLASS="arabic">8</SPAN> Example</A>
<LI><A ID="tex2html419"
  HREF="node11.html#SECTION00318900000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">8</SPAN>.<SPAN CLASS="arabic">9</SPAN> Examples</A>
</UL>
<BR>
<LI><A ID="tex2html420"
  HREF="node11.html#SECTION00319000000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">9</SPAN> SMTP Preprocessor</A>
<UL>
<LI><A ID="tex2html421"
  HREF="node11.html#SECTION00319100000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">1</SPAN> Configuration</A>
<LI><A ID="tex2html422"
  HREF="node11.html#SECTION00319200000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">2</SPAN> Example</A>
<LI><A ID="tex2html423"
  HREF="node11.html#SECTION00319300000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">3</SPAN> Default</A>
<LI><A ID="tex2html424"
  HREF="node11.html#SECTION00319400000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">4</SPAN> Note</A>
</UL>
<BR>
<LI><A ID="tex2html425"
  HREF="node11.html#SECTION003110000000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">10</SPAN> FTP/Telnet Preprocessor</A>
<UL>
<LI><A ID="tex2html426"
  HREF="node11.html#SECTION003110100000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">10</SPAN>.<SPAN CLASS="arabic">1</SPAN> Global Configuration</A>
<LI><A ID="tex2html427"
  HREF="node11.html#SECTION003110200000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">10</SPAN>.<SPAN CLASS="arabic">2</SPAN> Format</A>
<LI><A ID="tex2html428"
  HREF="node11.html#SECTION003110300000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">10</SPAN>.<SPAN CLASS="arabic">3</SPAN> Example Global Configuration</A>
<LI><A ID="tex2html429"
  HREF="node11.html#SECTION003110400000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">10</SPAN>.<SPAN CLASS="arabic">4</SPAN> Telnet Configuration</A>
<LI><A ID="tex2html430"
  HREF="node11.html#SECTION003110500000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">10</SPAN>.<SPAN CLASS="arabic">5</SPAN> Format</A>
<LI><A ID="tex2html431"
  HREF="node11.html#SECTION003110600000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">10</SPAN>.<SPAN CLASS="arabic">6</SPAN> Example Telnet Configuration</A>
<LI><A ID="tex2html432"
  HREF="node11.html#SECTION003110700000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">10</SPAN>.<SPAN CLASS="arabic">7</SPAN> FTP Server Configuration</A>
<LI><A ID="tex2html433"
  HREF="node11.html#SECTION003110800000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">10</SPAN>.<SPAN CLASS="arabic">8</SPAN> Example Default FTP Server Configuration</A>
<LI><A ID="tex2html434"
  HREF="node11.html#SECTION003110900000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">10</SPAN>.<SPAN CLASS="arabic">9</SPAN> Example IP specific FTP Server Configuration</A>
<LI><A ID="tex2html435"
  HREF="node11.html#SECTION0031101000000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">10</SPAN>.<SPAN CLASS="arabic">10</SPAN> FTP Server Configuration Options</A>
<LI><A ID="tex2html436"
  HREF="node11.html#SECTION0031101100000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">10</SPAN>.<SPAN CLASS="arabic">11</SPAN> FTP Client Configuration</A>
<LI><A ID="tex2html437"
  HREF="node11.html#SECTION0031101200000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">10</SPAN>.<SPAN CLASS="arabic">12</SPAN> Example Default FTP Client Configuration</A>
<LI><A ID="tex2html438"
  HREF="node11.html#SECTION0031101300000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">10</SPAN>.<SPAN CLASS="arabic">13</SPAN> Example IP specific FTP Client Configuration</A>
<LI><A ID="tex2html439"
  HREF="node11.html#SECTION0031101400000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">10</SPAN>.<SPAN CLASS="arabic">14</SPAN> FTP Client Configuration Options</A>
<LI><A ID="tex2html440"
  HREF="node11.html#SECTION0031101500000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">10</SPAN>.<SPAN CLASS="arabic">15</SPAN> Examples/Default Configuration from snort.conf</A>
</UL>
<BR>
<LI><A ID="tex2html441"
  HREF="node11.html#SECTION003111000000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">11</SPAN> SSH</A>
<UL>
<LI><A ID="tex2html442"
  HREF="node11.html#SECTION003111100000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">11</SPAN>.<SPAN CLASS="arabic">1</SPAN> Configuration</A>
<LI><A ID="tex2html443"
  HREF="node11.html#SECTION003111200000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">11</SPAN>.<SPAN CLASS="arabic">2</SPAN> Examples/Default Configuration from snort.conf</A>
</UL>
<BR>
<LI><A ID="tex2html444"
  HREF="node11.html#SECTION003112000000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">12</SPAN> DCE/RPC</A>
<UL>
<LI><A ID="tex2html445"
  HREF="node11.html#SECTION003112100000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">12</SPAN>.<SPAN CLASS="arabic">1</SPAN> Configuration</A>
<LI><A ID="tex2html446"
  HREF="node11.html#SECTION003112200000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">12</SPAN>.<SPAN CLASS="arabic">2</SPAN> Alerts</A>
<LI><A ID="tex2html447"
  HREF="node11.html#SECTION003112300000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">12</SPAN>.<SPAN CLASS="arabic">3</SPAN> Summary</A>
<LI><A ID="tex2html448"
  HREF="node11.html#SECTION003112400000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">12</SPAN>.<SPAN CLASS="arabic">4</SPAN> Configuration Examples</A>
<LI><A ID="tex2html449"
  HREF="node11.html#SECTION003112500000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">12</SPAN>.<SPAN CLASS="arabic">5</SPAN> Default Configuration from snort.conf</A>
</UL>
<BR>
<LI><A ID="tex2html450"
  HREF="node11.html#SECTION003113000000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">13</SPAN> DNS</A>
<UL>
<LI><A ID="tex2html451"
  HREF="node11.html#SECTION003113100000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">13</SPAN>.<SPAN CLASS="arabic">1</SPAN> Configuration</A>
<LI><A ID="tex2html452"
  HREF="node11.html#SECTION003113200000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">13</SPAN>.<SPAN CLASS="arabic">2</SPAN> Examples/Default Configuration from snort.conf</A>
</UL></UL>
<!--End of Table of Child-Links-->
<HR>

<H1><A ID="SECTION00310000000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN> Preprocessors</A>
</H1>

<P>
Preprocessors were introduced in version 1.5 of Snort. They allow
the functionality of Snort to be extended by allowing users and programmers
to drop modular plugins into Snort fairly easily.
Preprocessor code is run before the detection engine is called, but
after the packet has been decoded. The packet can be modified or analyzed
in an out-of-band manner using this mechanism.

<P>
Preprocessors are loaded and configured using the <SPAN style="font-family:monospace">preprocessor</SPAN> keyword.
The format of the preprocessor directive in the Snort rules file is:

<P>
<PRE>
preprocessor &lt;name&gt;: &lt;options&gt;
</PRE>

<P>

<DIV class="CENTER"><A ID="Preprocessor_Example"></A><A ID="3190"></A>
<TABLE>
<CAPTION class="BOTTOM"><STRONG>Figure:</STRONG>
Preprocessor Directive Format Example</CAPTION>
<TR><TD><IMG
 STYLE="height: 6.30ex; " SRC="img6.svg"
 ALT="\begin{figure}\begin{verbatim}preprocessor minfrag: 128\end{verbatim}
\par\end{figure}"></TD></TR>
</TABLE>
</DIV>

<P>

<H2><A ID="SECTION00311000000000000000"></A><A ID="frag3_section"></A>
<BR>
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">1</SPAN> Frag3 
</H2>

<P>
The frag3 preprocessor is a target-based IP defragmentation module for Snort.
Frag3 is intended as a replacement for the frag2 defragmentation module and 
was designed with the following goals:
 
<DL class="COMPACT">
 <DT> <B><SPAN CLASS="arabic">1</SPAN>.</B> 
<DD>Faster execution than frag2 with less complex data management.
<DT> <B><SPAN CLASS="arabic">2</SPAN>.</B> 
<DD>Target-based host modeling anti-evasion techniques. 
</DD>
</DL> 
<P>
The frag2 preprocessor used splay trees extensively for managing the data 
structures associated with defragmenting packets.  Splay trees are excellent 
data structures to use when you have some assurance of locality of reference
for the data that you are handling but in high speed, heavily fragmented 
environments the nature of the splay trees worked against the system and 
actually hindered performance.  Frag3 uses the sfxhash data structure and 
linked lists for data handling internally which allows it to have much more
predictable and deterministic performance in any environment which should 
aid us in managing heavily fragmented environments.

<P>
Target-based analysis is a relatively new concept in network-based intrusion
detection.  The idea of a target-based system is to model the actual targets
on the network instead of merely modeling the protocols and looking for 
attacks within them.  When IP stacks are written for different operating 
systems, they are usually implemented by people who read the RFCs and then
write their interpretation of what the RFC outlines into code.  Unfortunately, there
are ambiguities in the way that the RFCs define some of the edge conditions 
that may occurr and when this happens different people implement certain aspects
of their IP stacks differently.  For an IDS this is a big problem.

<P>
In an environment where the attacker can determine what style of IP 
defragmentation is being used on a particular target, the attacker can try to
fragment packets such that the target will put them back together in a 
specific manner while any passive systems trying to model the host traffic 
have to guess which way the target OS is going to handle the overlaps and 
retransmits.  As I like to say, if the attacker has more information about the
targets on a network than the IDS does, it is possible to evade the IDS.  This
is where the idea for &ldquo;target-based IDS&rdquo; came from.  For more detail on this
issue and how it affects IDS, check out the famous Ptacek &amp; Newsham paper at
http://www.snort.org/docs/idspaper/.

<P>
The basic idea behind target-based IDS is that we tell the IDS information 
about hosts on the network so that it can avoid Ptacek &amp; Newsham style evasion
attacks based on information about how an individual target IP stack operates.
Vern Paxson and Umesh Shankar did a great paper on this very topic in 2003 that 
detailed mapping the hosts on a network and determining how their various IP 
stack implementations handled the types of problems seen in IP defragmentation 
and TCP stream reassembly.  Check it out at http://www.icir.org/vern/papers/activemap-oak03.pdf.

<P>
We can also present the IDS with topology information to avoid TTL-based 
evasions and a variety of other issues, but that's a topic for another day.  
Once we have this information we can start to really change the game for these 
complex modeling problems.

<P>
Frag3 was implemented to showcase and prototype a target-based module within
Snort to test this idea.

<P>

<H3><A ID="SECTION00311100000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">1</SPAN> Frag 3 Configuration</A>
</H3>

<P>
Frag3 configuration is somewhat more complex than frag2.  There are at least
two preprocessor directives required to activate frag3, a global configuration
directive and an engine instantiation.  There can be an arbitrary number of
engines defined at startup with their own configuration, but only one global
configuration.

<P>
<SPAN  CLASS="textbf">Global Configuration</SPAN>

<UL>
<LI>Preprocessor name: <SPAN  CLASS="texttt">frag3_global</SPAN>
</LI>
<LI>Available options:
  NOTE: Global configuration options are comma separated.
  
<UL>
<LI><SPAN  CLASS="texttt">max_frags <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN>number<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN></SPAN> - Maximum simultaneous fragments to track. Default is 8192.
</LI>
<LI><SPAN  CLASS="texttt">memcap <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN>bytes<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN></SPAN> - Memory cap for self preservation.  Default is 4MB.  
</LI>
<LI><SPAN  CLASS="texttt">prealloc_frags <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN>number<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN></SPAN> - Alternate memory management mode.  Use preallocated fragment nodes (faster in some situations).
  
</LI>
</UL>
</LI>
</UL>    

<P>
<SPAN  CLASS="textbf">Engine Configuration</SPAN>

<UL>
<LI>Preprocessor name: <SPAN  CLASS="texttt">frag3_engine</SPAN>
</LI>
<LI>Available options:
  NOTE: Engine configuration options are space separated.
  
<UL>
<LI><SPAN  CLASS="texttt">timeout <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN>seconds<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN></SPAN> - Timeout for fragments.  Fragments in the engine for 
                         longer than this period will be automatically dropped.
                         Default is 60 seconds.

<P>
</LI>
<LI><SPAN  CLASS="texttt">ttl_limit <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN>hops<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN></SPAN> - Max TTL delta acceptable for packets based on the first
                        packet in the fragment.  Default is 5.

<P>
</LI>
<LI><SPAN  CLASS="texttt">min_ttl <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN>value<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN></SPAN> - Minimum acceptable TTL value for a fragment packet.  
                       Default is 1.

<P>
</LI>
<LI><SPAN  CLASS="texttt">detect_anomalies</SPAN> - Detect fragment anomalies.

<P>
</LI>
<LI><SPAN  CLASS="texttt">bind_to <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN>ip_list<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN></SPAN> - IP List to bind this engine to.  This engine will only
                         run for packets with destination addresses contained
                         within the IP List.  Default value is <SPAN  CLASS="texttt">all</SPAN>.

<P>
</LI>
<LI><SPAN  CLASS="texttt">policy <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN>type<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN></SPAN> - Select a target-based defragmentation mode.  Available 
                     types are first, last, bsd, bsd-right, linux.  Default
                     type is bsd.

<P>
The Paxson Active Mapping paper introduced the terminology
                     frag3 is using to describe policy types.  The known 
                     mappings are as follows.  Anyone who develops more 
                     mappings and would like to add to this list please feel
                     free to send us an email!

<P>
<TABLE class="PAD  BORDER" style="">
<TR><TH CLASS="LEFT"><SPAN  CLASS="textbf">Platform</SPAN></TH>
<TH CLASS="LEFT"><SPAN  CLASS="textbf">Type</SPAN></TH>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">AIX 2</TD>
<TD CLASS="LEFT">BSD</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">AIX 4.3 8.9.3</TD>
<TD CLASS="LEFT">BSD</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">Cisco IOS</TD>
<TD CLASS="LEFT">Last</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">FreeBSD</TD>
<TD CLASS="LEFT">BSD</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">HP JetDirect (printer)</TD>
<TD CLASS="LEFT">BSD-right</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">HP-UX B.10.20</TD>
<TD CLASS="LEFT">BSD</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">HP-UX 11.00</TD>
<TD CLASS="LEFT">First</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">IRIX 4.0.5F</TD>
<TD CLASS="LEFT">BSD</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">IRIX 6.2</TD>
<TD CLASS="LEFT">BSD</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">IRIX 6.3</TD>
<TD CLASS="LEFT">BSD</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">IRIX64 6.4</TD>
<TD CLASS="LEFT">BSD</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">Linux 2.2.10</TD>
<TD CLASS="LEFT">linux</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">Linux 2.2.14-5.0</TD>
<TD CLASS="LEFT">linux</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">Linux 2.2.16-3</TD>
<TD CLASS="LEFT">linux</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">Linux 2.2.19-6.2.10smp</TD>
<TD CLASS="LEFT">linux</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">Linux 2.4.7-10</TD>
<TD CLASS="LEFT">linux</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">Linux 2.4.9-31SGI 1.0.2smp</TD>
<TD CLASS="LEFT">linux</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">Linux 2.4 (RedHat 7.1-7.3)</TD>
<TD CLASS="LEFT">linux</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">MacOS (version unknown)</TD>
<TD CLASS="LEFT">First</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">NCD Thin Clients</TD>
<TD CLASS="LEFT">BSD</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">OpenBSD (version unknown)</TD>
<TD CLASS="LEFT">linux</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">OpenBSD (version unknown)</TD>
<TD CLASS="LEFT">linux</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">OpenVMS 7.1</TD>
<TD CLASS="LEFT">BSD</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">OS/2 (version unknown)</TD>
<TD CLASS="LEFT">BSD</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">OSF1 V3.0</TD>
<TD CLASS="LEFT">BSD</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">OSF1 V3.2</TD>
<TD CLASS="LEFT">BSD</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">OSF1 V4.0,5.0,5.1</TD>
<TD CLASS="LEFT">BSD</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">SunOS 4.1.4</TD>
<TD CLASS="LEFT">BSD</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">SunOS 5.5.1,5.6,5.7,5.8</TD>
<TD CLASS="LEFT">First</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">Tru64 Unix V5.0A,V5.1</TD>
<TD CLASS="LEFT">BSD</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">Vax/VMS</TD>
<TD CLASS="LEFT">BSD</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">Windows (95/98/NT4/W2K/XP)</TD>
<TD CLASS="LEFT">First</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
</TABLE>

<P>
</LI>
</UL>
</LI>
</UL>

<P>

<H3><A ID="SECTION00311200000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">2</SPAN> format</A>
</H3>

<P>

<DIV class="CENTER"><A ID="Frag3_Example_Basic"></A><A ID="3192"></A>
<TABLE>
<CAPTION class="BOTTOM"><STRONG>Figure:</STRONG>
Example configuration (Basic)</CAPTION>
<TR><TD><IMG
 STYLE="height: 9.08ex; " SRC="img7.svg"
 ALT="\begin{figure}\begin{verbatim}preprocessor frag3_global
preprocessor frag3_engine\end{verbatim}
\par\end{figure}"></TD></TR>
</TABLE>
</DIV>

<P>

<DIV class="CENTER"><A ID="Frag3_Example_Advanced"></A><A ID="3193"></A>
<TABLE>
<CAPTION class="BOTTOM"><STRONG>Figure:</STRONG>
Example configuration (Advanced)</CAPTION>
<TR><TD><IMG
 STYLE="height: 14.63ex; " SRC="img8.svg"
 ALT="\begin{figure}\begin{verbatim}preprocessor frag3_global: prealloc_nodes 8192
...
...sor frag3_engine: policy last, detect_anomalies\end{verbatim}
\par\end{figure}"></TD></TR>
</TABLE>
</DIV>

<P>
Note in the advanced example (Figure <A HREF="#Frag3_Example_Advanced"><IMG  ALT="[*]" SRC="crossref.png"></A>), there are three engines specified running with 
<SPAN  CLASS="textit">Linux</SPAN>, <SPAN  CLASS="texttt">first</SPAN> and <SPAN  CLASS="texttt">last</SPAN> policies assigned.  The first two engines are bound to
specific IP address ranges and the last one applies to all other traffic.
Packets that don't fall within the address requirements of the first two engines
automatically fall through to the third one.

<P>

<H3><A ID="SECTION00311300000000000000"></A><A ID="frag3_alert_output"></A>
<BR>
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">3</SPAN> Frag 3 Alert Output
</H3>

<P>
Frag3 is capable of detecting eight different types of anomalies.  Its event
output is packet-based so it will work with all output modes of Snort.  Read
the documentation in the <SPAN  CLASS="texttt">doc/signatures</SPAN> directory with filenames that begin
with &ldquo;123-&rdquo; for information on the different event types.

<P>

<H2><A ID="SECTION00312000000000000000"></A><A ID="stream_4_section"></A>
<BR>
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">2</SPAN> Stream4
</H2>

<P>
The Stream4 module provides TCP stream reassembly and stateful analysis
capabilities to Snort. Robust stream reassembly capabilities allow Snort
to ignore "stateless" attacks (which include the types of attacks that
Stick and Snot produce). Stream4 also gives large scale users the ability
to track many simultaneous TCP streams.  Stream4 is set to handle 8192
simultaneous TCP connections in its default configuration; however, it
scales to handle over 100,000 simultaneous connections.

<P>
Stream4 can also provide session tracking of UDP conversations. To enable
this in the Snort binary, pass <SPAN  CLASS="texttt">&ndash;enable-stream4udp</SPAN> to
<SPAN  CLASS="texttt">configure</SPAN> before compiling.  You will also need to enable it
in the <SPAN  CLASS="texttt">stream4</SPAN> configuration.

<P>
Stream4 contains two configurable modules: the global <SPAN  CLASS="texttt">stream4</SPAN> preprocessor
and the <SPAN  CLASS="texttt">stream4_reassemble</SPAN> preprocessor. 

<P>

        
        <p><table border="1"><tr><td><b>
        Note:&nbsp;&nbsp;</b>
Additional options can be used if Snort is running in inline mode. See Section <A HREF="node7.html#Stream4Inline"><IMG  ALT="[*]" SRC="crossref.png"></A> for more information.
        
        </b></td></tr></table></p>

<P>

<H3><A ID="SECTION00312100000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN> Stream4 Format</A>
</H3>

<P>
<PRE>
preprocessor stream4: [noinspect], [asynchronous_link], [keepstats [machine|binary]], \
                      [detect_scans], [log_flushed_streams], [detect_state_problems], \
                      [disable_evasion_alerts], [timeout &lt;seconds&gt;], [memcap &lt;bytes&gt;],  \
                      [max_sessions &lt;num sessions&gt;], [enforce_state], \
                      [cache_clean_sessions &lt;num of sessions&gt;], [ttl_limit &lt;count&gt;], \
                      [self_preservation_threshold &lt;threshold&gt;], \
                      [self_preservation_period &lt;seconds&gt;], \
                      [suspend_threshold &lt;threshold&gt;], [suspend_period &lt;seconds&gt;], \
                      [state_protection], [server_inspect_limit &lt;bytes&gt;], \
                      [enable_udp_sessions], [max_udp_sessions &lt;num sessions&gt;], \
                      [udp_ignore_any]
</PRE>
<TABLE class="PAD  BORDER" style="">
<TR><TH CLASS="LEFT"><SPAN  CLASS="textbf">Option</SPAN></TH>
<TH CLASS="LEFT"><SPAN  CLASS="textbf">Description</SPAN></TH>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">asynchronous_link</SPAN></TD>
<TD CLASS="LEFT">Uses state transitions based only on one-sided conversation (no tracking of acknowledge/sequence numbers).</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">cache_clean_sessions&nbsp;&lt;num&nbsp;sessions&gt;</SPAN></TD>
<TD CLASS="LEFT">Purges this number of least-recently used sessions from the session cache.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">detect_scans</SPAN></TD>
<TD CLASS="LEFT">Turns on alerts for portscan events.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">detect_state_problems</SPAN></TD>
<TD CLASS="LEFT">Turns on alerts for stream events of note, such as evasive RST packets, data on the SYN packet, and out of window sequence numbers.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">enforce_state</SPAN></TD>
<TD CLASS="LEFT">Enforces statefulness so that sessions aren't picked up mid-stream.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">keepstats</SPAN></TD>
<TD CLASS="LEFT">Records session summary information in <SPAN  CLASS="texttt"><SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN>logdir<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN>/session.log</SPAN>. If no options are specified, output is human readable.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">log_flushed_streams</SPAN></TD>
<TD CLASS="LEFT">Log the packets that are part of reassembled stream.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">disable_evasion_alerts</SPAN></TD>
<TD CLASS="LEFT">Turns off alerts for events such as TCP
overlap.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">timeout &lt;seconds&gt;</SPAN></TD>
<TD CLASS="LEFT">Amount of time to keep an inactive stream in the state table; sessions that are flushed will automatically be picked up again if more activity is seen. The default value is 30 seconds.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">memcap &lt;bytes&gt;</SPAN></TD>
<TD CLASS="LEFT">Sets the number of bytes used to store packets for reassembly.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">max_sessions &lt;num sessions&gt;</SPAN></TD>
<TD CLASS="LEFT">Sets the maximum number of simultaneous sessions.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">noinspect</SPAN></TD>
<TD CLASS="LEFT">Disables stateful inspection.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">ttl_limit &lt;count&gt;</SPAN></TD>
<TD CLASS="LEFT">Sets the delta value that will set off an evasion alert.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">self_preservation_threshold &lt;threshold&gt;</SPAN></TD>
<TD CLASS="LEFT">Set limit on number of sessions before entering self-preservation mode (only reassemble data on the default ports).</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">self_preservation_period &lt;seconds&gt;</SPAN></TD>
<TD CLASS="LEFT">Set length of time (seconds) to remain in self-preservation mode.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">suspend_threshold &lt;threshold&gt;</SPAN></TD>
<TD CLASS="LEFT">Sets limit on number of sessions before entering suspend mode (no reassembly).</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">suspend_period &lt;seconds&gt;</SPAN></TD>
<TD CLASS="LEFT">Sets length of time (seconds) to remain in suspend mode.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">server_inspect_limit &lt;bytes&gt;</SPAN></TD>
<TD CLASS="LEFT">Restricts inspection of server traffic to this many bytes until another client request is seen (ie: client packet with data).</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">state_protection</SPAN></TD>
<TD CLASS="LEFT">Protects self against DoS attacks.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">enable_udp_sessions</SPAN></TD>
<TD CLASS="LEFT">Enable UDP session tracking.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">max_udp_sessions &lt;num sessions&gt;</SPAN></TD>
<TD CLASS="LEFT">The maximum number of UDP sessions to be tracked. Default is 8192 if UDP sessions are enabled.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">udp_ignore_any</SPAN></TD>
<TD CLASS="LEFT">Ignore traffic on port without port-specific rules.  The result of this is that NO rules (include IP only rules) are applied to UDP traffic that has a source/destination port that is listed in a port-specific ruls.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
</TABLE>

<P>

<H3><A ID="SECTION00312200000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN> stream4_reassemble Format</A>
</H3>

<P>
<PRE>
preprocessor stream4_reassemble: [clientonly], [serveronly], [both], [noalerts], \
                                 [favor_old], [favor_new], [flush_on_alert], \
                                 [flush_behavior random|default|large_window], \
                                 [flush_base &lt;number&gt;], [flush_range &lt;number&gt;], \
                                 [flush_seed &lt;number&gt;], [overlap_limit &lt;number&gt;], \
                                 [ports &lt;portlist&gt;], [emergency_ports &lt;portlist&gt;] \
                                 [zero_flushed_packets], [flush_data_diff_size &lt;number&gt;] \
                                 [large_packet_performance]
</PRE>
<TABLE class="PAD  BORDER" style="">
<TR><TH CLASS="LEFT"><SPAN  CLASS="textbf">Option</SPAN></TH>
<TH CLASS="LEFT TOP"  WIDTH=250><SPAN  CLASS="textbf">Description</SPAN></TH>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=250>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">clientonly</SPAN></TD>
<TD CLASS="LEFT TOP"  WIDTH=250>Provides reassembly for the client side of a connection
only.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=250>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">serveronly</SPAN></TD>
<TD CLASS="LEFT TOP"  WIDTH=250>Provides reassembly for the server side of a connection
only.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=250>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">both</SPAN></TD>
<TD CLASS="LEFT TOP"  WIDTH=250>Reassemble for client and server sides of connection.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=250>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">noalerts</SPAN></TD>
<TD CLASS="LEFT TOP"  WIDTH=250>Won't alert on events that may be insertion or evasion
attacks.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=250>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">favor_old</SPAN></TD>
<TD CLASS="LEFT TOP"  WIDTH=250>Favor old segments based on sequence number over a new segments.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=250>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">favor_new</SPAN></TD>
<TD CLASS="LEFT TOP"  WIDTH=250>Favor new segments based on sequence number over a old segments.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=250>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">flush_on_alert</SPAN></TD>
<TD CLASS="LEFT TOP"  WIDTH=250>Flush a stream when an individual packet causes an alert.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=250>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">flush_behavior random|default|large_window</SPAN></TD>
<TD CLASS="LEFT TOP"  WIDTH=250>Use specified flush behavior. <SPAN  CLASS="texttt">default</SPAN> means use old static flush points. <SPAN  CLASS="texttt">large_window</SPAN> means use new larger flush points. <SPAN  CLASS="texttt">random</SPAN> means use random flush points defined by <SPAN  CLASS="texttt">flush_base</SPAN>, <SPAN  CLASS="texttt">flush_seed</SPAN> and <SPAN  CLASS="texttt">flush_range</SPAN>.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=250>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">flush_base &lt;number&gt;</SPAN></TD>
<TD CLASS="LEFT TOP"  WIDTH=250>Lowest allowed random flush point.  The default value is 512 bytes.  Only used if <SPAN  CLASS="texttt">flush_behavior</SPAN> is <SPAN  CLASS="texttt">random</SPAN>.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=250>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">flush_range &lt;number&gt;</SPAN></TD>
<TD CLASS="LEFT TOP"  WIDTH=250>Space within random flush points are generated.  The default value is 1213.  Only used if <SPAN  CLASS="texttt">flush_behavior</SPAN> is <SPAN  CLASS="texttt">random</SPAN>.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=250>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">flush_seed &lt;number&gt;</SPAN></TD>
<TD CLASS="LEFT TOP"  WIDTH=250>Random seed for flush points.  The default value is computed from Snort PID + time.  Only used if <SPAN  CLASS="texttt">flush_behavior</SPAN> is <SPAN  CLASS="texttt">random</SPAN>.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=250>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">overlap_limit &lt;number&gt;</SPAN></TD>
<TD CLASS="LEFT TOP"  WIDTH=250>Alert when the number of overlapping data bytes reaches a threshold.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=250>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">ports &lt;portlist&gt;</SPAN></TD>
<TD CLASS="LEFT TOP"  WIDTH=250>Provides reassembly for a
whitespace-separated list of ports.  By default, reassembly is performed
for ports 21, 23, 25, 42, 53, 80, 110, 111, 135, 136, 137, 139, 143, 445,
513, 1443, 1521, and 3306. To perform reassembly for all ports, use
<SPAN  CLASS="texttt">all</SPAN> as the port list.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=250>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">emergency_ports &lt;portlist&gt;</SPAN></TD>
<TD CLASS="LEFT TOP"  WIDTH=250>Emergency ports are those which we ALWAYS do reassembly when in 'self-preservation' mode. They are used to have a lowest level when snort is under duress because of high traffic rates. The default ports are the same as for the ports option.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=250>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">flush_data_diff_size &lt;number&gt;</SPAN></TD>
<TD CLASS="LEFT TOP"  WIDTH=250>minumum size of a packet to zero out the empty space in a rebuilt packet.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=250>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">zero_flushed_packets</SPAN></TD>
<TD CLASS="LEFT TOP"  WIDTH=250>Zero out any space that is not filled in when flushing a rebuilt packet.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=250>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">large_packet_performance</SPAN></TD>
<TD CLASS="LEFT TOP"  WIDTH=250>Do not buffer and reassemble consecutive large packets (larger than twice the flush point). The chances of catching an attack that spans those large packets is small, compared to the CPU and memory utilization to copy and re-copy the large packet.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=250>&nbsp;</TD>
</TR>
</TABLE>

<P>

<H3><A ID="SECTION00312300000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">3</SPAN> Notes</A>
</H3>

<P>
Just setting the <SPAN  CLASS="texttt">stream4</SPAN> and <SPAN  CLASS="texttt">stream4_reassemble</SPAN> directives without
arguments in the <SPAN  CLASS="texttt">snort.conf</SPAN> file will set them up in their default
configurations shown in Table <A HREF="#Stream4_Defaults"><IMG  ALT="[*]" SRC="crossref.png"></A> and Table <A HREF="#stream4_reassemble_defaults"><IMG  ALT="[*]" SRC="crossref.png"></A>.

<P>
<BR>

<P>
<BR><P></P>
<DIV class="CENTER">

<P>

<P>
<DIV class="CENTER">
<A ID="3198"></A>
<TABLE class="PAD  BORDER" style="">
<CAPTION><STRONG>Table:</STRONG>
Stream4 Defaults</CAPTION>
<TR><TH CLASS="LEFT"><SPAN  CLASS="textbf">Option</SPAN></TH>
<TH CLASS="LEFT"><SPAN  CLASS="textbf">Default</SPAN></TH>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">session timeout (<SPAN  CLASS="texttt">timeout</SPAN>)</TD>
<TD CLASS="LEFT">30 seconds</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">session memory cap (<SPAN  CLASS="texttt">memcap</SPAN>)</TD>
<TD CLASS="LEFT">8388608 bytes</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">stateful inspection (<SPAN  CLASS="texttt">noinspect</SPAN>)</TD>
<TD CLASS="LEFT">active (<SPAN  CLASS="texttt">noinspect</SPAN> disabled)</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">stream stats (<SPAN  CLASS="texttt">keepstats</SPAN>)</TD>
<TD CLASS="LEFT">inactive</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">state problem alerts (<SPAN  CLASS="texttt">detect_state_problems</SPAN>)</TD>
<TD CLASS="LEFT">inactive (<SPAN  CLASS="texttt">detect_state_problems</SPAN> disabled)</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">evasion alerts (<SPAN  CLASS="texttt">disable_evasion_alerts</SPAN>)</TD>
<TD CLASS="LEFT">inactive (<SPAN  CLASS="texttt">disable_evasion_alerts</SPAN> enabled)</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">asynchronous link (<SPAN  CLASS="texttt">asynchronous_link</SPAN>)</TD>
<TD CLASS="LEFT">inactive</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">log flushed streams (<SPAN  CLASS="texttt">log_flushed_streams</SPAN>)</TD>
<TD CLASS="LEFT">inactive</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">max TCP sessions (<SPAN  CLASS="texttt">max_sessions</SPAN>)</TD>
<TD CLASS="LEFT">8192</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">session cache purge (<SPAN  CLASS="texttt">cache_clean_sessions</SPAN>)</TD>
<TD CLASS="LEFT">5</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">self preservation threshold (<SPAN  CLASS="texttt">self_preservation_threshold</SPAN>)</TD>
<TD CLASS="LEFT">50 sessions/sec</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">self preservation period (<SPAN  CLASS="texttt">self_preservation_period</SPAN>)</TD>
<TD CLASS="LEFT">90 seconds</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">suspend threshold (<SPAN  CLASS="texttt">suspend_threshold</SPAN>)</TD>
<TD CLASS="LEFT">200 sessions/sec</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">suspend period (<SPAN  CLASS="texttt">suspend_period</SPAN>)</TD>
<TD CLASS="LEFT">30 seconds</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">state protection (<SPAN  CLASS="texttt">state_protection</SPAN>)</TD>
<TD CLASS="LEFT">inactive</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">server inspect limit (<SPAN  CLASS="texttt">server_inspect_limit</SPAN>)</TD>
<TD CLASS="LEFT">-1 (inactive)</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">UDP session tracking (<SPAN  CLASS="texttt">enable_udp_sessions</SPAN>)</TD>
<TD CLASS="LEFT">inactive</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">max UDP sessions (<SPAN  CLASS="texttt">max_udp_sessions</SPAN>)</TD>
<TD CLASS="LEFT">8192</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
</TABLE>
</DIV>
</DIV>
<BR>

<P>
<BR><P></P>
<DIV class="CENTER">

<P>

<P>
<DIV class="CENTER">
<A ID="3199"></A>
<TABLE class="PAD  BORDER" style="">
<CAPTION><STRONG>Table:</STRONG>
stream4_reassemble Defaults</CAPTION>
<TR><TH CLASS="LEFT"><SPAN  CLASS="textbf">Option</SPAN></TH>
<TH CLASS="LEFT"><SPAN  CLASS="textbf">Default</SPAN></TH>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=276>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">reassemble client (<SPAN  CLASS="texttt">clientonly</SPAN>)</TD>
<TD CLASS="LEFT">active</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=276>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">reassemble server (<SPAN  CLASS="texttt">serveronly</SPAN>)</TD>
<TD CLASS="LEFT">inactive</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=276>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">reassemble both (<SPAN  CLASS="texttt">both</SPAN>)</TD>
<TD CLASS="LEFT">inactive</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=276>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">reassemble ports (<SPAN  CLASS="texttt">ports</SPAN>)</TD>
<TD CLASS="LEFT">21 23 25 42 53 80 110 111 135 136 137 139 143 445 513 1433 1521 3306</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=276>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">emergency reassemble ports (<SPAN  CLASS="texttt">ports</SPAN>)</TD>
<TD CLASS="LEFT">21 23 25 42 53 80 110 111 135 136 137 139 143 445 513 1433 1521 3306</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=276>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">reassembly alerts (<SPAN  CLASS="texttt">noalerts</SPAN>)</TD>
<TD CLASS="LEFT">active (<SPAN  CLASS="texttt">noalerts</SPAN> disabled)</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=276>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">favor old packet (<SPAN  CLASS="texttt">favor_old</SPAN>)</TD>
<TD CLASS="LEFT">active</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=276>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">favor new packet (<SPAN  CLASS="texttt">favor_new</SPAN>)</TD>
<TD CLASS="LEFT">inactive</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=276>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">flush on alert (<SPAN  CLASS="texttt">flush_on_alert</SPAN>)</TD>
<TD CLASS="LEFT">inactive</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=276>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">overlap limit (<SPAN  CLASS="texttt">overlap_limit</SPAN>)</TD>
<TD CLASS="LEFT">-1 (inactive)</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=276>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">large packet performance (<SPAN  CLASS="texttt">large_packet_performance</SPAN>)</TD>
<TD CLASS="LEFT">inactive</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=276>&nbsp;</TD>
</TR>
</TABLE>
</DIV>
</DIV>
<BR>

<P>

<P>

<H2><A ID="SECTION00313000000000000000"></A><A ID="sub:flow"></A>
<BR>
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">3</SPAN> Flow
</H2>

<P>
The Flow tracking module is meant to start unifying the state keeping
mechanisms of Snort into a single place. As of Snort 2.1.0, only a portscan
detector is implemented, but in the long term,  many of the stateful subsystems
of Snort will be migrated over to becoming flow plugins. With the introduction
of flow, this effectively makes the conversation preprocessor obsolete.

<P>
An IPv4 flow is unique when the IP protocol (<SPAN  CLASS="texttt">ip_proto</SPAN>), source IP (<SPAN  CLASS="texttt">sip</SPAN>),
source port (<SPAN  CLASS="texttt">sport</SPAN>), destination IP (<SPAN  CLASS="texttt">dip</SPAN>), and destination port (<SPAN  CLASS="texttt">dport</SPAN>) are the
same.  The <SPAN  CLASS="texttt">dport</SPAN> and <SPAN  CLASS="texttt">sport</SPAN> are 0 unless the protocol is TCP or UDP.

<P>

<H3><A ID="SECTION00313100000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">3</SPAN>.<SPAN CLASS="arabic">1</SPAN> Format</A>
</H3>
<PRE>
preprocessor flow: [memcap &lt;bytes&gt;], [rows &lt;count&gt;], \
                   [stats_interval &lt;seconds&gt;], [hash &lt;1|2&gt;]
</PRE>

<P>
<BR><P></P>
<DIV class="CENTER">


<TABLE   STYLE="width:885;">
<TR><TD>
<DIV class="CENTER">
<A ID="780"></A>
<TABLE class="PAD  BORDER" style="">
<CAPTION><STRONG>Table:</STRONG>
Flow Options</CAPTION>
<TR><TH CLASS="LEFT"><SPAN  CLASS="textbf">Option</SPAN></TH>
<TH CLASS="LEFT"><SPAN  CLASS="textbf">Description</SPAN></TH>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">memcap</SPAN></TD>
<TD CLASS="LEFT">Number of bytes to allocate.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">rows</SPAN></TD>
<TD CLASS="LEFT">Number of rows for the flow hash table. <A ID="tex2html10"
  HREF="#footmp790"><SUP><SPAN CLASS="arabic">1</SPAN></SUP></A></TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">stats_interval</SPAN></TD>
<TD CLASS="LEFT">Interval (in seconds) to dump statistics to STDOUT. Set this to 0 to disable.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">hash</SPAN></TD>
<TD CLASS="LEFT">Hashing method to use.<A ID="tex2html11"
  HREF="#footmp793"><SUP><SPAN CLASS="arabic">2</SPAN></SUP></A></TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
</TABLE>
</DIV></TD></TR>
<TR CLASS="LEFT">
<TD><DL>
<DD><A ID="footmp790"><SUP><SPAN CLASS="arabic">1</SPAN></SUP></A> This number can be increased, at the cost of using more memory, to enhance performance. Increasing rows provides a larger hash table.
</DD>

<DD><A ID="footmp793"><SUP><SPAN CLASS="arabic">2</SPAN></SUP></A> 1 - hash by byte, 2 - hash by integer (faster, not as much of a chance to become diverse).  The hash table has a pseudo-random salt picked to make algorithmic complexity attacks much more difficult.
</DD>
</DL></TD></TR>
</TABLE>
</DIV>
<BR>

<P>

<H3><A ID="SECTION00313200000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">3</SPAN>.<SPAN CLASS="arabic">2</SPAN> Example Configuration</A>
</H3>

<P>
<PRE>
preprocessor flow: stats_interval 0 hash 2
</PRE>

<P>

<H2><A ID="SECTION00314000000000000000"></A><A ID="stream_5_section"></A>
<BR>
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">4</SPAN> Stream5
</H2>

<P>
The Stream5 preprocessor is a target-based TCP reassembly module
for Snort.  It is intended to replace both the Stream4 and flow
preprocessors, and it is capable of tracking sessions for both
TCP and UDP.  With Stream5, the rule 'flow' and 'flowbits' keywords
are usable with TCP as well as UDP traffic.

<P>

        
        <p><table border="1"><tr><td><b>
        Note:&nbsp;&nbsp;</b>
Since Stream5 replaces Stream4, both cannot be used simultaneously.
Remove the Stream4 and flow configurations from snort.conf when the
Stream5 configuration is added.
        
        </b></td></tr></table></p>

<P>

<H3><A ID="SECTION00314100000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">1</SPAN> Transport Protocols</A>
</H3>

<P>
TCP sessions are identified via the classic TCP "connection".  UDP
sessions are established as the result of a series of UDP packets
from two end points via the same set of ports.  ICMP messages are
tracked for the purposes of checking for unreachable and service
unavailable messages, which effectively terminate a TCP or UDP
session.

<P>

<H3><A ID="SECTION00314200000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">2</SPAN> Target-Based</A>
</H3>

<P>
Stream5, like Frag3, introduces target-based actions for handling
of overlapping data and other TCP anomalies.  The methods for handling
overlapping data, TCP Timestamps, Data on SYN, FIN and Reset sequence
numbers, etc. and the policies supported by Stream5 are the results of
extensive research with many target operating systems.

<P>

<H3><A ID="SECTION00314300000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">3</SPAN> Stream API</A>
</H3>

<P>
Stream5 fully supports the Stream API (partly supported by Stream4),
allowing other protocol normalizers/preprocessors to dynamically
configure reassembly behavior as required by the application layer
protocol, identify sessions that may be ignored (large data transfers,
etc), and update the identifying information about the session
(application protocol, direction, etc) that can later be used by rules.

<P>

<H3><A ID="SECTION00314400000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">4</SPAN> Anomaly Detection</A>
</H3>

<P>
TCP protocol anomalies, such as data on SYN packets, data received
outside the TCP window, etc are configured via the <SPAN  CLASS="texttt">detect_anomalies</SPAN>
option to the TCP configuration.  Some of these anomalies are
detected on a per-target basis.  For example, a few operating systems
allow data in TCP SYN packets, while others do not.

<P>

<H3><A ID="SECTION00314500000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">5</SPAN> Stream5 Global Configuration</A>
</H3>

<P>
Global settings for the Stream5 preprocessor.

<P>
<PRE>
preprocessor stream5_global: [track_tcp &lt;yes|no&gt;], [max_tcp &lt;number&gt;], \
                      [memcap &lt;number bytes&gt;], \
                      [track_udp &lt;yes|no&gt;], [max_udp &lt;number&gt;], \
                      [track_icmp &lt;yes|no&gt;], [max_icmp &lt;number&gt;], \
                      [flush_on_alert], [show_rebuilt_packets]
</PRE>

<P>
<TABLE class="PAD  BORDER" style="">
<TR><TH CLASS="LEFT"><SPAN  CLASS="textbf">Option</SPAN></TH>
<TH CLASS="LEFT"><SPAN  CLASS="textbf">Description</SPAN></TH>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">track_tcp &lt;yes|no&gt;</SPAN></TD>
<TD CLASS="LEFT">Track sessions for TCP.  The default is "yes".</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">max_tcp &lt;num sessions&gt;</SPAN></TD>
<TD CLASS="LEFT">Maximum simultaneous TCP sessions tracked.  The default is "256000", maximum is "1052672", minimum is "1".</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">memcap &lt;num bytes&gt;</SPAN></TD>
<TD CLASS="LEFT">Memcap for TCP packet storage.  The default is "8388608" (8MB), maximum is "1073741824" (1GB), minimum is "32768" (32KB).</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">track_udp &lt;yes|no&gt;</SPAN></TD>
<TD CLASS="LEFT">Track sessions for UDP.  The default is "yes".</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">max_udp &lt;num sessions&gt;</SPAN></TD>
<TD CLASS="LEFT">Maximum simultaneous UDP sessions tracked.  The default is "128000", maximum is "1052672", minimum is "1".</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">track_icmp &lt;yes|no&gt;</SPAN></TD>
<TD CLASS="LEFT">Track sessions for ICMP.  The default is "yes".</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">max_icmp &lt;num sessions&gt;</SPAN></TD>
<TD CLASS="LEFT">Maximum simultaneous ICMP sessions tracked.  The default is "64000", maximum is "1052672", minimum is "1".</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">flush_on_alert</SPAN></TD>
<TD CLASS="LEFT">Backwards compatibilty.  Flush a TCP stream when an alert is generated on that stream.  The default is set to off.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">show_rebuilt_packets</SPAN></TD>
<TD CLASS="LEFT">Print/display packet after rebuilt (for debugging).  The default is set to off.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
</TABLE>

<P>

<H3><A ID="SECTION00314600000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">6</SPAN> Stream5 TCP Configuration</A>
</H3>

<P>
Provides a means on a per IP address target to configure TCP policy.
This can have multiple occurances, per policy that is bound to an IP
address or network.  One default policy must be specified, and that policy
is not bound to an IP address or network.

<P>
<PRE>
preprocessor stream5_tcp: [bind_to &lt;ip_addr&gt;], [timeout &lt;number secs&gt;], \
                      [policy &lt;policy_id&gt;], [min_ttl &lt;number&gt;], \
                      [overlap_limit &lt;number&gt;], [max_window &lt;number&gt;], \
                      [require_3whs [&lt;number secs&gt;]], [detect_anomalies], \
                      [check_session_hijacking], [use_static_footprint_sizes], \
                      [dont_store_large_packets], \
                      [ports &lt;client|server|both&gt; &lt;all|number [number]*&gt;]
</PRE>

<P>
<TABLE class="PAD  BORDER" style="">
<TR><TH CLASS="LEFT"><SPAN  CLASS="textbf">Option</SPAN></TH>
<TH CLASS="LEFT"><SPAN  CLASS="textbf">Description</SPAN></TH>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">bind_to &lt;ip_addr&gt;</SPAN></TD>
<TD CLASS="LEFT">IP address or network for this policy.  The default is set to any.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">timeout &lt;num seconds&gt;</SPAN></TD>
<TD CLASS="LEFT">Session timeout.  The default is "30",  the minimum is "1", and the maximum is "86400" (approximately 1 day).</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">policy &lt;policy_id&gt;</SPAN></TD>
<TD CLASS="LEFT">The Operating System policy for the target OS.
The policy_id can be one of the following:
<TABLE class="PAD  BORDER" style="">
<TR><TD CLASS="LEFT">Policy Name</TD>
<TD CLASS="LEFT">Operating Systems.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=230>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">first</SPAN></TD>
<TD CLASS="LEFT">Favor first overlapped segment.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=230>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">last</SPAN></TD>
<TD CLASS="LEFT">Favor first overlapped segment.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=230>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">bsd</SPAN></TD>
<TD CLASS="LEFT">FresBSD 4.x and newer, NetBSD 2.x and newer, OpenBSD 3.x and newer</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=230>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">linux</SPAN></TD>
<TD CLASS="LEFT">Linux 2.4 and newer</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=230>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">old-linux</SPAN></TD>
<TD CLASS="LEFT">Linux 2.2 and earlier</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=230>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">windows</SPAN></TD>
<TD CLASS="LEFT">Windows 2000, Windows XP, Windows 95/98/ME</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=230>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">win2003</SPAN></TD>
<TD CLASS="LEFT">Windows 2003 Server</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=230>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">vista</SPAN></TD>
<TD CLASS="LEFT">Windows Vista</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=230>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">solaris</SPAN></TD>
<TD CLASS="LEFT">Solaris 9.x and newer</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=230>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">hpux</SPAN></TD>
<TD CLASS="LEFT">HPUX 11 and newer</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=230>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">hpux10</SPAN></TD>
<TD CLASS="LEFT">HPUX 10</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=230>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">irix</SPAN></TD>
<TD CLASS="LEFT">IRIX 6 and newer</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=230>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">macos</SPAN></TD>
<TD CLASS="LEFT">MacOS 10.3 and newer</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=230>&nbsp;</TD>
</TR>
</TABLE></TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">min_ttl &lt;number&gt;</SPAN></TD>
<TD CLASS="LEFT">Minimum TTL.  The default is "1", the minimum is "1" and the maximum is "255".</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">overlap_limit &lt;number&gt;</SPAN></TD>
<TD CLASS="LEFT">Limits the number of overlapping packets per session.  The default is "0" (unlimited), the minimum is "0", and the maximum is "255".</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">max_window &lt;number&gt;</SPAN></TD>
<TD CLASS="LEFT">Maximum TCP window allowed.  The default is "0" (unlimited), the minimum is "0", and the maximum is "1073725440" (65535 left shift 14).  That is the highest possible TCP window per RFCs.  This option is intended to prevent a DoS against Stream5 by an attacker using an abnormally large window, so using a value near the maximum is discouraged.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">require_3whs [&lt;number seconds&gt;]</SPAN></TD>
<TD CLASS="LEFT">Establish sessions only on completion of a SYN/SYN-ACK/ACK handshake.  The default is set to off.  The optional number of seconds specifies a startup timeout.  This allows a grace period for existing sessions to be considered established during that interval immediately after Snort is started.  The default is "0" (don't consider existing sessions established), the minimum is "0", and the maximum is "86400" (approximately 1 day).</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">detect_anomalies</SPAN></TD>
<TD CLASS="LEFT">Detect and alert on TCP protocol anomalies.  The default is set to off.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">check_session_hijacking</SPAN></TD>
<TD CLASS="LEFT">Check for TCP session hijacking.  This check validates the hardware (MAC) address from both sides of the connect &ndash; as established on the 3-way handshake against subsequent packets received on the session.  If an ethernet layer is not part of the protocol stack received by Snort, there are no checks performed.  Alerts are generated (per '<SPAN  CLASS="texttt">detect_anomalies</SPAN>' option) for either the client or server when the MAC address for one side or the other does not match.  The default is set to off.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">use_static_footprint_sizes</SPAN></TD>
<TD CLASS="LEFT">emulate Stream4 behavior for building reassembled packet.  The default is set to off.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">dont_store_large_packets</SPAN></TD>
<TD CLASS="LEFT">Performance improvement to not queue large packets in reassembly buffer.  The default is set to off.  Using this option may result in missed attacks.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">ports &lt;client|server|both&gt; &lt;all|number(s)&gt;</SPAN></TD>
<TD CLASS="LEFT">Specify the client, server, or both and list of ports in which to perform reassembly.  This can appear more than once in a given config.  The default settings are <SPAN  CLASS="texttt">ports client 21 23 25 42 53 80 110 111 135 136 137 139 143 445 513 1433 1521 3306</SPAN>.  The minimum port allowed is "1" and the maximum allowed is "65535".</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
</TABLE>

<P>

        
        <p><table border="1"><tr><td><b>
        Note:&nbsp;&nbsp;</b>
If no options are specified for a given TCP policy, that is the default
TCP policy.  If only a bind_to option is used with no other options that
TCP policy uses all of the default values.
        
        </b></td></tr></table></p>

<P>

<H3><A ID="SECTION00314700000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">7</SPAN> Stream5 UDP Configuration</A>
</H3>

<P>
Configuration for UDP session tracking.  Since there is no target based
binding, there should be only one occurance of the UDP configuration.

<P>
<PRE>
preprocessor stream5_udp: [timeout &lt;number secs&gt;], [ignore_any_rules]
</PRE>

<P>
<TABLE class="PAD  BORDER" style="">
<TR><TH CLASS="LEFT"><SPAN  CLASS="textbf">Option</SPAN></TH>
<TH CLASS="LEFT"><SPAN  CLASS="textbf">Description</SPAN></TH>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">timeout &lt;num seconds&gt;</SPAN></TD>
<TD CLASS="LEFT">Session timeout.  The default is "30", the minimum is "1", and the maximum is "86400" (approximately 1 day).</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">ignore_any_rules</SPAN></TD>
<TD CLASS="LEFT">Don't process any <SPAN  CLASS="texttt">-&gt;</SPAN> any (ports) rules for UDP that attempt to match payload if there are no port specific rules for the src or destination port.  Rules that have flow or flowbits will never be ignored.  This is a performance improvement and may result in missed attacks.  Using this does not affect rules that look at protocol headers, only those with content, PCRE, or byte test options.  The default is "off".</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
</TABLE>

<P>

        
        <p><table border="1"><tr><td><b>
        Note:&nbsp;&nbsp;</b>
With the ignore_any_rules option, a UDP rule will be ignored except when
there is another port specific rule that may be applied to the traffic.  For
example, if a UDP rule specifies destination port 53, the 'ignored' any <SPAN  CLASS="texttt">-&gt;</SPAN> any
rule will be applied to traffic to/from port 53, but NOT to any other
source or destination port.  A list of rule SIDs affected by this option
are printed at Snort's startup.
        
        </b></td></tr></table></p>

<P>

        
        <p><table border="1"><tr><td><b>
        Note:&nbsp;&nbsp;</b>
With the ignore_any_rules option, if a UDP rule that uses any <SPAN  CLASS="texttt">-&gt;</SPAN> any
ports includes either flow or flowbits, the ignore_any_rules option is
effectively pointless.  Because of the potential impact of disabling a flowbits
rule, the ignore_any_rules option will be disabled in this case.
        
        </b></td></tr></table></p>

<P>

<H3><A ID="SECTION00314800000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">8</SPAN> Stream5 ICMP Configuration</A>
</H3>

<P>
Configuration for ICMP session tracking.  Since there is no target based
binding, there should be only one occurance of the ICMP configuration.

<P>

        
        <p><table border="1"><tr><td><b>
        Note:&nbsp;&nbsp;</b>
ICMP is currently untested, in minimal code form and is NOT ready
for use in production networks.  It is not turned on by default.
        
        </b></td></tr></table></p>

<P>
<PRE>
preprocessor stream5_icmp: [timeout &lt;number secs&gt;]
</PRE>

<P>
<TABLE class="PAD  BORDER" style="">
<TR><TH CLASS="LEFT"><SPAN  CLASS="textbf">Option</SPAN></TH>
<TH CLASS="LEFT"><SPAN  CLASS="textbf">Description</SPAN></TH>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">timeout &lt;num seconds&gt;</SPAN></TD>
<TD CLASS="LEFT">Session timeout.  The default is "30", the minimum is "1", and the maximum is "86400" (approximately 1 day).</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
</TABLE>

<P>

<H3><A ID="SECTION00314900000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">9</SPAN> Example Configurations</A>
</H3>

<P>

<OL>
<LI>
This example configuration emulates the default behavior of flow and
Stream4 (with UDP support enabled).  It is the default configuration in
snort.conf.

<P>
<PRE>
preprocessor stream5_global: max_tcp 8192, track_tcp yes, \
                            track_udp yes, track_icmp no \
preprocessor stream5_tcp: policy first, use_static_footprint_sizes
preprocessor stream5_udp: ignore_any_rules
</PRE>

<P>
</LI>
<LI>
This configuration maps two network segments to different OS policies, one
for Windows and one for Linux, with all other traffic going to the default
policy of Solaris.

<P>
<PRE>
preprocessor stream5_global: track_tcp yes
preprocessor stream5_tcp: bind_to 192.168.1.0/24, policy windows
preprocessor stream5_tcp: bind_to 10.1.1.0/24, policy linux
preprocessor stream5_tcp: policy solaris
</PRE>

<P>
</LI>
</OL>

<P>

<H3><A ID="SECTION003141000000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">10</SPAN> Alerts</A>
</H3>
Stream5 uses generator ID 129.  It is capable of alerting on 8 (eight)
anomalies, all of which relate to TCP anomalies.  There are no
anomalies detected relating to UDP or ICMP.

<P>
The list of SIDs is as follows:

<OL>
<LI>SYN on established session
</LI>
<LI>Data on SYN packet
</LI>
<LI>Data sent on stream not accepting data
</LI>
<LI>TCP Timestamp is outside of PAWS window
</LI>
<LI>Bad segment, overlap adjusted size less than/equal 0
</LI>
<LI>Window size (after scaling) larger than policy allows
</LI>
<LI>Limit on number of overlapping TCP packets reached
</LI>
<LI>Data after Reset packet
</LI>
</OL>

<P>

<H2><A ID="SECTION00315000000000000000"></A><A ID="sfportscan_section"></A>
<BR>
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">5</SPAN> sfPortscan
</H2>

<P>
The sfPortscan module, developed by Sourcefire, is designed to detect the 
first phase in a network attack: Reconnaissance. In the Reconnaissance phase, 
an attacker determines
what types of network protocols or services a host supports. This is
the traditional place where a portscan takes place. This phase assumes
the attacking host has no prior knowledge of what protocols or
services are supported by the target; otherwise, this phase would not
be necessary.

<P>
As the attacker has no beforehand knowledge of its intended target,
most queries sent by the attacker will be negative (meaning that the
service ports are closed). In the nature of legitimate network
communications, negative responses from hosts are rare, and rarer
still are multiple negative responses within a given amount of time.
Our primary objective in detecting portscans is to detect and track
these negative responses.

<P>
One of the most common portscanning tools in use today is Nmap. Nmap
encompasses many, if not all, of the current portscanning techniques.
sfPortscan was designed to be able to detect the different types of
scans Nmap can produce.

<P>
sfPortscan will currently alert for the following types of Nmap scans:

<UL>
<LI>TCP Portscan
</LI>
<LI>UDP Portscan
</LI>
<LI>IP Portscan
</LI>
</UL>

<P>
These alerts are for one<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.31ex; vertical-align: -0.12ex; " SRC="img9.svg"
 ALT="$\rightarrow$"></SPAN>one portscans, which are the traditional
types of scans; one host scans multiple ports on another host. Most of
the port queries will be negative, since most hosts have relatively
few services available.

<P>
sfPortscan also alerts for the following types of decoy portscans:

<UL>
<LI>TCP Decoy Portscan
</LI>
<LI>UDP Decoy Portscan
</LI>
<LI>IP Decoy Portscan
</LI>
</UL>

<P>
Decoy portscans are much like the Nmap portscans described above, only the attacker has a spoofed
source address inter-mixed with the real scanning address. This tactic
helps hide the true identity of the attacker.

<P>
sfPortscan alerts for the following types of distributed portscans:

<UL>
<LI>TCP Distributed Portscan
</LI>
<LI>UDP Distributed Portscan
</LI>
<LI>IP Distributed Portscan
</LI>
</UL>

<P>
These are many<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.31ex; vertical-align: -0.12ex; " SRC="img9.svg"
 ALT="$\rightarrow$"></SPAN>one portscans. Distributed portscans occur when
multiple hosts query one host for open services. This is used to evade
an IDS and obfuscate command and control hosts.

<P>

        
        <p><table border="1"><tr><td><b>
        Note:&nbsp;&nbsp;</b>
Negative queries will be distributed among scanning hosts, so
we track this type of scan through the scanned host.
        
        </b></td></tr></table></p>

<P>
sfPortscan alerts for the following types of portsweeps:

<UL>
<LI>TCP Portsweep
</LI>
<LI>UDP Portsweep
</LI>
<LI>IP Portsweep
</LI>
<LI>ICMP Portsweep
</LI>
</UL>

<P>
These alerts are for one<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.31ex; vertical-align: -0.12ex; " SRC="img9.svg"
 ALT="$\rightarrow$"></SPAN>many portsweeps. One host scans a single port
on multiple hosts. This usually occurs when a new exploit comes out and the
attacker is looking for a specific service. 

<P>

        
        <p><table border="1"><tr><td><b>
        Note:&nbsp;&nbsp;</b>
The characteristics of a portsweep scan may not result in many
negative responses. For example, if an attacker portsweeps a web farm
for port 80, we will most likely not see many negative responses.
        
        </b></td></tr></table></p>

<P>
sfPortscan alerts on the following filtered portscans and portsweeps:

<P>

<UL>
<LI>TCP Filtered Portscan
</LI>
<LI>UDP Filtered Portscan
</LI>
<LI>IP Filtered Portscan

<P>
</LI>
<LI>TCP Filtered Decoy Portscan
</LI>
<LI>UDP Filtered Decoy Portscan
</LI>
<LI>IP Filtered Decoy Portscan

<P>
</LI>
<LI>TCP Filtered Portsweep
</LI>
<LI>UDP Filtered Portsweep
</LI>
<LI>IP Filtered Portsweep
</LI>
<LI>ICMP Filtered Portsweep

<P>
</LI>
<LI>TCP Filtered Distributed Portscan
</LI>
<LI>UDP Filtered Distributed Portscan
</LI>
<LI>IP Filtered Distributed Portscan
</LI>
</UL>

<P>
&ldquo;Filtered&rdquo; alerts indicate that there were no network errors (ICMP
unreachables or TCP RSTs) or responses on closed ports have been
suppressed. It's also a good indicator of whether the alert is just a
very active legitimate host. Active hosts, such as NATs, can trigger
these alerts because they can send out many connection attempts within
a very small amount of time. A filtered alert may go off before
responses from the remote hosts are received.

<P>
sfPortscan only generates one alert for each host pair in question during
the time window (more on windows below). On TCP scan alerts, sfPortscan
will also display any open ports that were scanned. On TCP sweep alerts
however, sfPortscan will only track open ports after the alert has been
triggered. Open port events are not individual alerts, but tags based
on the orginal scan alert.

<P>

<H3><A ID="SECTION00315100000000000000"></A><A ID="sfportscan_configuration"></A>
<BR>
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">5</SPAN>.<SPAN CLASS="arabic">1</SPAN> sfPortscan Configuration
</H3>

<P>
You may want to use the following line in your <SPAN  CLASS="texttt">snort.conf</SPAN> to disable evasion alerts 
within stream4 because some
scan packets can cause these alerts to be generated:

<P>
<PRE>
  preprocessor stream4: disable_evasion_alerts
</PRE>

<P>
Use of the Flow preprocessor is required for sfPortscan. Flow gives
portscan direction in the case of connectionless protocols like ICMP
and UDP. You should enable the Flow preprocessor in your <SPAN  CLASS="texttt">snort.conf</SPAN> by 
using the following:

<P>
<PRE>
  preprocessor flow: stats_interval 0 hash 2
</PRE>

<P>
The parameters you can use to configure the portscan module are:

<P>
 
<DL class="COMPACT">
 <DT> <B><SPAN CLASS="arabic">3</SPAN>.</B> 
<DD><SPAN  CLASS="textbf">proto <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN>protocol<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN></SPAN>

<P>
Available options:
  
<UL>
<LI><SPAN  CLASS="texttt">TCP</SPAN>
</LI>
<LI><SPAN  CLASS="texttt">UDP</SPAN>
</LI>
<LI><SPAN  CLASS="texttt">IGMP</SPAN>
</LI>
<LI><SPAN  CLASS="texttt">ip_proto</SPAN>
</LI>
<LI><SPAN  CLASS="texttt">all</SPAN>
   
</LI>
</UL>

<P>
<DT> <B><SPAN CLASS="arabic">4</SPAN>.</B> 
<DD><SPAN  CLASS="textbf">scan_type <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN>scan_type<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN></SPAN>

<P>
Available options: 
   
<UL>
<LI><SPAN  CLASS="texttt">portscan</SPAN> 
</LI>
<LI><SPAN  CLASS="texttt">portsweep</SPAN> 
</LI>
<LI><SPAN  CLASS="texttt">decoy_portscan</SPAN>
</LI>
<LI><SPAN  CLASS="texttt">distributed_portscan</SPAN>
</LI>
<LI><SPAN  CLASS="texttt">all</SPAN>
	
</LI>
</UL>

<P>
<DT> <B><SPAN CLASS="arabic">5</SPAN>.</B> 
<DD><SPAN  CLASS="textbf">sense_level <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN>level<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN></SPAN>

<P>
Available options:
  
<UL>
<LI><SPAN  CLASS="texttt">low</SPAN> - &ldquo;Low&rdquo; alerts are only generated on error packets sent from the
  target host, and because of the nature of error responses, this
  setting should see very few false postives. However, this setting
  will never trigger a Filtered Scan alert because of a lack of error
  responses. This setting is based on a static time window of 60
  seconds, afterwhich this window is reset.
</LI>
<LI><SPAN  CLASS="texttt">medium</SPAN> - &ldquo;Medium&rdquo; alerts track connection counts, and so will generate
  filtered scan alerts. This setting may false positive on active
  hosts (NATs, proxies, DNS caches, etc), so the user may need to
  deploy the use of Ignore directives to properly tune this directive.
</LI>
<LI><SPAN  CLASS="texttt">high</SPAN> - &ldquo;High&rdquo; alerts continuously track hosts on a network using a time
  window to evaluate portscan statistics for that host. A "High"
  setting will catch some slow scans because of the continuous
  monitoring, but is very sensitive to active hosts. This most
  definitely will require the user to tune sfPortscan.
  
</LI>
</UL>

<P>
<DT> <B><SPAN CLASS="arabic">6</SPAN>.</B> 
<DD><SPAN  CLASS="textbf">watch_ip <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN>ip1<SPAN CLASS="MATH"><IMG
 STYLE="height: 2.78ex; vertical-align: -0.70ex; " SRC="img5.svg"
 ALT="$\vert$"></SPAN>ip2/cidr[:[port<SPAN CLASS="MATH"><IMG
 STYLE="height: 2.78ex; vertical-align: -0.70ex; " SRC="img5.svg"
 ALT="$\vert$"></SPAN>port2-port3]]<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN> </SPAN>

<P>
Defines which IPs, networks, and specific ports on those hosts to watch.
  The list is a comma separated list of IP addresses, IP address using CIDR
  notation.  Optionally, ports are specified after the IP address/CIDR using
  a colon and can be either a single port or a range denoted by a dash.
  IPs or networks not falling into this range are ignored if this option
  is used.

<P>
<DT> <B><SPAN CLASS="arabic">7</SPAN>.</B> 
<DD><SPAN  CLASS="textbf">ignore_scanners <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN>ip_list<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN> </SPAN>

<P>
Ignores the source of scan alerts.  <SPAN  CLASS="texttt">ip_list</SPAN> can be a comma
  separated list of IP addresses or IP addresses using CIDR notation.

<P>
<DT> <B><SPAN CLASS="arabic">8</SPAN>.</B> 
<DD><SPAN  CLASS="textbf">ignore_scanned <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN>ip_list<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN> </SPAN>

<P>
Ignores the destination of scan alerts. <SPAN  CLASS="texttt">ip_list</SPAN> can be a comma
  separated list of IP addresses or IP addresses using CIDR notation.

<P>
<DT> <B><SPAN CLASS="arabic">9</SPAN>.</B> 
<DD><SPAN  CLASS="textbf">logfile <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN>file<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN> </SPAN> 

<P>
This option will output portscan events to the file specified. If
  <SPAN  CLASS="texttt">file</SPAN> does not contain a leading slash, this file will be placed in
  the Snort config dir. 
</DD>
</DL> 
<P>

<H3><A ID="SECTION00315200000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">5</SPAN>.<SPAN CLASS="arabic">2</SPAN> Format</A>
</H3>

<P>
<PRE>
preprocessor sfportscan: proto &lt;protocols&gt; \
scan_type &lt;portscan|portsweep|decoy_portscan|distributed_portscan|all&gt;\
sense_level &lt;low|medium|high&gt; watch_ip &lt;IP or IP/CIDR&gt; ignore_scanners &lt;IP list&gt;\
ignore_scanned &lt;IP list&gt; logfile &lt;path and filename&gt;
</PRE>

<P>

<DIV class="CENTER"><A ID="sfPortscan_Example"></A><A ID="3210"></A>
<TABLE>
<CAPTION class="BOTTOM"><STRONG>Figure:</STRONG>
sfPortscan Preprocessor Configuration</CAPTION>
<TR><TD><IMG
 STYLE="height: 14.34ex; " SRC="img10.svg"
 ALT="\begin{figure}\begin{verbatim}preprocessor flow: stats_interval 0 hash 2
pre...
...o { all } \
scan_type { all } \
sense_level { low }\end{verbatim}
\end{figure}"></TD></TR>
</TABLE>
</DIV>

<P>

<H3><A ID="SECTION00315300000000000000"></A><A ID="sfportscan_alert_output"></A>
<BR>
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">5</SPAN>.<SPAN CLASS="arabic">3</SPAN> sfPortscan Alert Output
</H3>

<P>

<H4><A ID="SECTION00315310000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">5</SPAN>.<SPAN CLASS="arabic">3</SPAN>.<SPAN CLASS="arabic">1</SPAN> Unified Output</A>
</H4>

<P>
In order to get all the portscan information logged with the alert, snort
generates a pseudo-packet and uses the payload portion to store the additional
portscan information of priority count, connection count, IP count, port count,
IP range, and port range.  The characteristics of the packet are:

<P>
<PRE>
Src/Dst MAC Addr == MACDAD
IP Protocol == 255
IP TTL == 0
</PRE>

<P>
Other than that, the packet looks like the IP portion of the packet that caused
the portscan alert to be generated.  This includes any IP options, etc.  The
payload and payload size of the packet are equal to the length of the additional
portscan information that is logged.  The size tends to be around 100 - 200
bytes.

<P>
Open port alerts differ from the other portscan alerts, because open port alerts
utilize the tagged packet output system.  This means that if an output system
that doesn't print tagged packets is used, then the user won't see open port
alerts.  The open port information is stored in the IP payload and
contains the port that is open.

<P>
The sfPortscan alert output was designed to work with unified packet logging, so
it is possible to extend favorite Snort GUIs to display portscan alerts and the
additional information in the IP payload using the above packet characteristics.

<P>

<H4><A ID="SECTION00315320000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">5</SPAN>.<SPAN CLASS="arabic">3</SPAN>.<SPAN CLASS="arabic">2</SPAN> Log File Output</A>
</H4>

<P>
Log file output is displayed in the following format, and explained further
below:

<P>
<PRE>
	Time: 09/08-15:07:31.603880
	event_id: 2
	192.168.169.3 -&gt; 192.168.169.5 (portscan) TCP Filtered Portscan
	Priority Count: 0
	Connection Count: 200
	IP Count: 2
	Scanner IP Range: 192.168.169.3:192.168.169.4
	Port/Proto Count: 200
	Port/Proto Range: 20:47557
</PRE>

<P>
If there are open ports on the target, one or more additional tagged packet(s)
will be appended:

<P>
<PRE>
	Time: 09/08-15:07:31.603881
	event_ref: 2
	192.168.169.3 -&gt; 192.168.169.5 (portscan) Open Port
	Open Port: 38458
</PRE>

<P>
 
<DL class="COMPACT">
 <DT> <B><SPAN CLASS="arabic">10</SPAN>.</B> 
<DD><SPAN  CLASS="textbf">Event_id/Event_ref</SPAN>

<P>
These fields are used to link an alert with the corresponding 
     <SPAN  CLASS="texttt">Open Port</SPAN> tagged packet

<P>
<DT> <B><SPAN CLASS="arabic">11</SPAN>.</B> 
<DD><SPAN  CLASS="textbf">Priority Count</SPAN>

<P>
<SPAN  CLASS="texttt">Priority Count</SPAN> keeps track of bad responses (resets,
     unreachables). The higher the priority count, the more bad
     responses have been received.

<P>
<DT> <B><SPAN CLASS="arabic">12</SPAN>.</B> 
<DD><SPAN  CLASS="textbf">Connection Count</SPAN>

<P>
<SPAN  CLASS="texttt">Connection Count</SPAN> lists how many connections are active on the
     hosts (src or dst). This is accurate for connection-based
     protocols, and is more of an estimate for others. Whether or not a
     portscan was filtered is determined here. High connection count and
     low priority count would indicate filtered (no response received
     from target).

<P>
<DT> <B><SPAN CLASS="arabic">13</SPAN>.</B> 
<DD><SPAN  CLASS="textbf">IP Count</SPAN>

<P>
IP Count keeps track of the last IP to contact a host, and
     increments the count if the next IP is different. For one-to-one
     scans, this is a low number. For active hosts this number will
     be high regardless, and one-to-one scans may appear as a
     distributed scan.

<P>
<DT> <B><SPAN CLASS="arabic">14</SPAN>.</B> 
<DD><SPAN  CLASS="textbf">Scanned/Scanner IP Range</SPAN>

<P>
This field changes depending on the type of alert. Portsweep
     (one-to-many) scans display the scanned IP range; Portscans
     (one-to-one) display the scanner IP. 

<P>
<DT> <B><SPAN CLASS="arabic">15</SPAN>.</B> 
<DD><SPAN  CLASS="textbf">Port Count</SPAN>

<P>
Port Count keeps track of the last port contacted and increments
     this number when that changes. We use this count (along with IP
     Count) to determine the difference between one-to-one portscans
     and one-to-one decoys. 
</DD>
</DL> 
<P>

<H3><A ID="SECTION00315400000000000000"></A><A ID="tuning_sfportscan"></A>
<BR>
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">5</SPAN>.<SPAN CLASS="arabic">4</SPAN> Tuning sfPortscan
</H3>

<P>
The most important aspect in detecting portscans is tuning the detection engine
for your network(s).  Here are some tuning tips:

<P>
 
<DL class="COMPACT">

<DT> <B><SPAN CLASS="arabic">16</SPAN>.</B> 
<DD><SPAN  CLASS="textbf">Use the watch_ip, ignore_scanners, and ignore_scanned options.</SPAN>

<P>
It's important to correctly set these options.  The <SPAN  CLASS="texttt">watch_ip</SPAN> option is easy
     to understand.  The analyst should set this option to the list of Cidr 
     blocks and IPs that they want to watch.  If no <SPAN  CLASS="texttt">watch_ip</SPAN> is defined, 
     sfPortscan will watch all network traffic.

<P>
The <SPAN  CLASS="texttt">ignore_scanners</SPAN> and <SPAN  CLASS="texttt">ignore_scanned</SPAN> options come into play in weeding
     out legitimate hosts that are very active on your network.  Some of the
     most common examples are NAT IPs, DNS cache servers, syslog servers, and
     nfs servers.  sfPortscan may not generate false positives for these types
     of hosts, but be aware when first tuning sfPortscan for these IPs. 
     Depending on the type of alert that the host generates, the analyst will
     know which to ignore it as.  If the host is generating portsweep events,
     then add it to the <SPAN  CLASS="texttt">ignore_scanners</SPAN> option.  If the host is generating
     portscan alerts (and is the host that is being scanned), add it to the
     <SPAN  CLASS="texttt">ignore_scanned</SPAN> option.

<P>
<DT> <B><SPAN CLASS="arabic">17</SPAN>.</B> 
<DD><SPAN  CLASS="textbf">Filtered scan alerts are much more prone to false positives.</SPAN>

<P>
When determining false positives, the alert type is very important.  Most of
     the false positives that sfPortscan may generate are of the filtered scan
     alert type.  So be much more suspicious of filtered portscans.  Many times
     this just indicates that a host was very active during the time period in
     question.  If the host continually generates these types of alerts, add it
     to the <SPAN  CLASS="texttt">ignore_scanners</SPAN> list or use a lower sensitivity level.

<P>
<DT> <B><SPAN CLASS="arabic">18</SPAN>.</B> 
<DD><SPAN  CLASS="textbf">Make use of the Priority Count, Connection Count, IP Count, Port Count, IP Range, and Port Range to determine false positives.</SPAN>

<P>
The portscan alert details are vital in determining the scope of a portscan
     and also the confidence of the portscan.  In the future, we hope to
     automate much of this analysis in assigning a scope level and confidence
     level, but for now the user must manually do this.  The easiest way to
     determine false positives is through simple ratio estimations.  The
     following is a list of ratios to estimate and the associated values that
     indicate a legimite scan and not a false positive.

<P>
<SPAN  CLASS="textbf">Connection Count / IP Count:</SPAN>  This ratio indicates an estimated average of
     connections per IP.  For portscans, this ratio should be high, the higher
     the better.  For portsweeps, this ratio should be low.

<P>
<SPAN  CLASS="textbf">Port Count / IP Count:</SPAN>  This ratio indicates an estimated average of ports
     connected to per IP.  For portscans, this ratio should be high and
     indicates that the scanned host's ports were connected to by fewer IPs. 
     For portsweeps, this ratio should be low, indicating that the scanning host
     connected to few ports but on many hosts.

<P>
<SPAN  CLASS="textbf">Connection Count / Port Count:</SPAN>  This ratio indicates an estimated average
     of connections per port.  For portscans, this ratio should be low.  This
     indicates that each connection was to a different port.  For portsweeps,
     this ratio should be high.  This indicates that there were many connections
     to the same port.

<P>
The reason that <SPAN  CLASS="texttt">Priority Count</SPAN> is not included, is because the priority
     count is included in the connection count and the above comparisons take
     that into consideration.  The Priority Count play an important role in
     tuning because the higher the priority count the more likely it is a real
     portscan or portsweep (unless the host is firewalled).

<P>
<DT> <B><SPAN CLASS="arabic">19</SPAN>.</B> 
<DD><SPAN  CLASS="textbf">If all else fails, lower the sensitivity level.</SPAN>

<P>
If none of these other tuning techniques work or the analyst doesn't have
     the time for tuning, lower the sensitivity level.  You get the best
     protection the higher the sensitivity level, but it's also important that
     the portscan detection engine generate alerts that the analyst will find
     informative.  The low sensitivity level only generates alerts based on
     error responses.  These responses indicate a portscan and the alerts
     generated by the low sensitivity level are highly accurate and require the
     least tuning.  The low sensitivity level does not catch filtered scans;
     since these are more prone to false positives. 
</DD>
</DL> 
<P>

<H2><A ID="SECTION00316000000000000000"></A><A ID="sub:rpc-decoder"></A>
<BR>
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">6</SPAN> RPC Decode
</H2>

<P>
The rpc_decode preprocessor normalizes RPC multiple fragmented
records into a single un-fragmented record.  It does this by
normalizing the packet into the packet buffer.  If stream4 is
enabled, it will only process client-side traffic.  By default, it runs against
traffic on ports 111 and 32771.

<P>
<BR><P></P>
<DIV class="CENTER">

<P>

<P>
<DIV class="CENTER">
<A ID="3214"></A>
<TABLE class="PAD  BORDER" style="">
<CAPTION><STRONG>Table:</STRONG>
RPC Decoder Options</CAPTION>
<TR><TH CLASS="LEFT"><SPAN  CLASS="textbf">Option</SPAN></TH>
<TH CLASS="LEFT"><SPAN  CLASS="textbf">Description</SPAN></TH>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">alert_fragments</SPAN></TD>
<TD CLASS="LEFT">Alert on any fragmented RPC record.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">no_alert_multiple_requests</SPAN></TD>
<TD CLASS="LEFT">Don't alert when there are multiple records in one packet.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">no_alert_large_fragments</SPAN></TD>
<TD CLASS="LEFT">Don't alert when the sum of fragmented records exceeds one packet.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN  CLASS="texttt">no_alert_incomplete</SPAN></TD>
<TD CLASS="LEFT">Don't alert when a single fragment record exceeds the size of one
packet.</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
</TR>
</TABLE>
</DIV>
</DIV>
<BR>

<P>

<H3><A ID="SECTION00316100000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">6</SPAN>.<SPAN CLASS="arabic">1</SPAN> Format</A>
</H3>

<P>
<PRE>
preprocessor rpc_decode: &lt;ports&gt; [ alert_fragments ] \
   [no_alert_multiple_requests] [no_alert_large_fragments] \
   [no_alert_incomplete]
</PRE>

<P>

<H2><A ID="SECTION00317000000000000000"></A><A ID="sub:perfmonitor"></A>
<BR>
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">7</SPAN> Performance Monitor
</H2>

<P>
This preprocessor measures Snort's real-time and theoretical maximum
performance.  Whenever this preprocessor is turned on, it should have an output
mode enabled, either &ldquo;console&rdquo; which prints statistics to the console window or
&ldquo;file&rdquo; with a file name, where statistics get printed to the specified file
name. By default, Snort's real-time statistics are processed. This includes:

<P>

<UL>
<LI>Time Stamp
</LI>
<LI>Drop Rate
</LI>
<LI>Mbits/Sec (wire) [duplicated below for easy comparison with other rates]
</LI>
<LI>Alerts/Sec 
</LI>
<LI>K-Pkts/Sec (wire) [duplicated below for easy comparison with other rates]
</LI>
<LI>Avg Bytes/Pkt (wire) [duplicated below for easy comparison with other rates]
</LI>
<LI>Pat-Matched [percent of data received that Snort processes in pattern matching]
</LI>
<LI>Syns/Sec
</LI>
<LI>SynAcks/Sec
</LI>
<LI>New Sessions Cached/Sec
</LI>
<LI>Sessions Del fr Cache/Sec
</LI>
<LI>Current Cached Sessions
</LI>
<LI>Max Cached Sessions
</LI>
<LI>Stream Flushes/Sec
</LI>
<LI>Stream Session Cache Faults
</LI>
<LI>Stream Session Cache Timeouts
</LI>
<LI>New Frag Trackers/Sec
</LI>
<LI>Frag-Completes/Sec
</LI>
<LI>Frag-Inserts/Sec
</LI>
<LI>Frag-Deletes/Sec
</LI>
<LI>Frag-Auto Deletes/Sec [memory DoS protection]
</LI>
<LI>Frag-Flushes/Sec
</LI>
<LI>Frag-Current [number of current Frag Trackers]
</LI>
<LI>Frag-Max [max number of Frag Trackers at any time]
</LI>
<LI>Frag-Timeouts
</LI>
<LI>Frag-Faults
</LI>
<LI>Number of CPUs [*** Only if compiled with LINUX_SMP ***, the next three appear for each CPU]
</LI>
<LI>CPU usage (user)
</LI>
<LI>CPU usage (sys)
</LI>
<LI>CPU usage (Idle)
</LI>
<LI>Mbits/Sec (wire) [average mbits of total traffic]
</LI>
<LI>Mbits/Sec (ipfrag) [average mbits of IP fragmented traffic]
</LI>
<LI>Mbits/Sec (ipreass) [average mbits Snort injects after IP reassembly]
</LI>
<LI>Mbits/Sec (tcprebuilt) [average mbits Snort injects after stream4 reassembly]
</LI>
<LI>Mbits/Sec (applayer) [average mbits seen by rules and protocol decoders]
</LI>
<LI>Avg Bytes/Pkt (wire)
</LI>
<LI>Avg Bytes/Pkt (ipfrag)
</LI>
<LI>Avg Bytes/Pkt (ipreass)
</LI>
<LI>Avg Bytes/Pkt (tcprebuilt)
</LI>
<LI>Avg Bytes/Pkt (applayer)
</LI>
<LI>K-Pkts/Sec (wire)
</LI>
<LI>K-Pkts/Sec (ipfrag)
</LI>
<LI>K-Pkts/Sec (ipreass)
</LI>
<LI>K-Pkts/Sec (tcprebuilt)
</LI>
<LI>K-Pkts/Sec (applayer)
</LI>
<LI>Total Packets Received
</LI>
<LI>Total Packets Dropped (not processed)
</LI>
<LI>Total Packets Blocked (inline)
</LI>
</UL>

<P>
The following options can be used with the performance monitor:

<P>

<UL>
<LI><SPAN  CLASS="texttt">flow</SPAN> - Prints out statistics about the type
of traffic and protocol distributions that Snort is seeing. This option can
produce large amounts of output.

<P>
</LI>
<LI><SPAN  CLASS="texttt">events</SPAN> - Turns on event reporting.  This prints out statistics as
to the number of signatures that were matched by the setwise pattern matcher 
(<SPAN  CLASS="textit">non-qualified events</SPAN>) and the number of those matches that were 
verified with the signature flags (<SPAN  CLASS="textit">qualified events</SPAN>).
This shows the user if there
is a problem with the rule set that they are running.

<P>
</LI>
<LI><SPAN  CLASS="texttt">max</SPAN> - Turns on the theoretical maximum performance that Snort
calculates given the processor speed and current performance.  This is only
valid for uniprocessor machines, since many operating systems don't keep
accurate kernel statistics for multiple CPUs.  

<P>
</LI>
<LI><SPAN  CLASS="texttt">console</SPAN> - Prints statistics at the console.

<P>
</LI>
<LI><SPAN  CLASS="texttt">file</SPAN> - Prints statistics in a comma-delimited format to the file
that is specified.  Not all statistics are output to this file.  You may
also use <SPAN  CLASS="texttt">snortfile</SPAN> which will output into your defined Snort log
directory.  Both of these directives can be overridden on the command
line with the <SPAN  CLASS="texttt">-Z</SPAN> or <SPAN  CLASS="texttt">&ndash;perfmon-file</SPAN> options.

<P>
</LI>
<LI><SPAN  CLASS="texttt">pktcnt</SPAN> - Adjusts the number of packets to process before checking for
the time sample.  This boosts performance, since checking the time sample
reduces Snort's performance.  By default, this is 10000.  

<P>
</LI>
<LI><SPAN  CLASS="texttt">time</SPAN> - Represents the number of seconds between intervals.

<P>
</LI>
<LI><SPAN  CLASS="texttt">accumulate</SPAN> or <SPAN  CLASS="texttt">reset</SPAN> - Defines which type of drop statistics
are kept by the operating system. By default, <SPAN  CLASS="texttt">reset</SPAN> is used.

<P>
</LI>
<LI><SPAN  CLASS="texttt">atexitonly</SPAN> - Dump stats for entire life of Snort.

<P>
</LI>
</UL>
<H3><A ID="SECTION00317100000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">7</SPAN>.<SPAN CLASS="arabic">1</SPAN> Examples</A>
</H3>

<P>
<PRE>
preprocessor perfmonitor: time 30 events flow file stats.profile max \
    console pktcnt 10000 
preprocessor perfmonitor: time 300 file /var/tmp/snortstat pktcnt 10000
</PRE>

<P>

<H2><A ID="SECTION00318000000000000000"></A><A ID="sub:http-inspect"></A>
<BR>
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">8</SPAN> HTTP Inspect 
</H2>

<P>
HTTP Inspect is a generic HTTP decoder for user applications.  Given a data
buffer, HTTP Inspect will decode the buffer, find HTTP fields, and normalize the
fields.  HTTP Inspect works on both client requests and server responses.

<P>
The current version of HTTP Inspect only handles stateless processing.  This
means that HTTP Inspect looks for HTTP fields on a packet-by-packet basis, and
will be fooled if packets are not reassembled.  This works fine when there is
another module handling the reassembly, but there are limitations in analyzing
the protocol.  Future versions will have a stateful processing mode which will
hook into various reassembly modules.

<P>
HTTP Inspect has a very &ldquo;rich&rdquo; user configuration.  Users can configure
individual HTTP servers with a variety of options, which should allow the user
to emulate any type of web server. Within HTTP Inspect, there are two areas of
configuration: global and server.

<P>

<H3><A ID="SECTION00318100000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">8</SPAN>.<SPAN CLASS="arabic">1</SPAN> Global Configuration</A>
</H3>

<P>
The global configuration deals with configuration options that determine the
global functioning of HTTP Inspect.  The following example gives the generic
global configuration format:

<P>

<H3><A ID="SECTION00318200000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">8</SPAN>.<SPAN CLASS="arabic">2</SPAN> Format</A>
</H3>
<PRE>
preprocessor http_inspect: global \
                           iis_unicode_map &lt;map_filename&gt; \
                           codemap &lt;integer&gt; \
                           [detect_anomalous_servers] \
                           [proxy_alert]
</PRE>

<P>
You can only have a single global configuration, you'll get an error if you try
otherwise.

<P>

<H4><A ID="SECTION00318210000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">8</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN> Configuration</A>
</H4>
 
<DL class="COMPACT">
 <DT> <B><SPAN CLASS="arabic">20</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">iis_unicode_map <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN>map_filename<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN> [codemap <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN>integer<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN>]</SPAN>

<P>
This is the global <SPAN  CLASS="texttt">iis_unicode_map</SPAN> file.  The <SPAN  CLASS="texttt">iis_unicode_map</SPAN> is a required
configuration parameter.  The map file can reside in the same directory as
<SPAN  CLASS="texttt">snort.conf</SPAN> or be specified via a fully-qualified path to the map file.

<P>
The <SPAN  CLASS="texttt">iis_unicode_map</SPAN> file is a Unicode codepoint map which tells HTTP Inspect
which codepage to use when decoding Unicode characters.  For US servers, the
codemap is usually 1252.

<P>
A Microsoft US Unicode codepoint map is provided in the Snort source <SPAN  CLASS="texttt">etc</SPAN>
directory by default.  It is called <SPAN  CLASS="texttt">unicode.map</SPAN> and should be used if no
other codepoint map is available.  A tool is supplied with Snort to generate
custom Unicode <SPAN  CLASS="texttt">maps&ndash;ms_unicode_generator.c</SPAN>, which is available at
http://www.snort.org/dl/contrib/.

<P>

        
        <p><table border="1"><tr><td><b>
        Note:&nbsp;&nbsp;</b>
Remember that this configuration is for the global IIS Unicode map, individual
servers can reference their own IIS Unicode map.
        
        </b></td></tr></table></p>

<P>
<DT> <B><SPAN CLASS="arabic">21</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">detect_anomalous_servers</SPAN>

<P>
This global configuration option enables generic HTTP server traffic
inspection on non-HTTP configured ports, and alerts if HTTP traffic is seen.
Don't turn this on if you don't have a default server configuration that
encompasses all of the HTTP server ports that your users might access.  In the
future, we want to limit this to specific networks so it's more useful, but
for right now, this inspects all network traffic.

<P>
<DT> <B><SPAN CLASS="arabic">22</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">proxy_alert</SPAN>

<P>
This enables global alerting on HTTP server proxy usage.  By configuring
HTTP Inspect servers and enabling <SPAN  CLASS="texttt">allow_proxy_use</SPAN>, you will only receive proxy
use alerts for web users that aren't using the configured proxies or are using
a rogue proxy server.

<P>
Please note that if users aren't required to configure web proxy use, then
you may get a lot of proxy alerts.  So, please only use this feature with
traditional proxy environments. Blind firewall proxies don't count.

<P>
</DD>
</DL>
<H3><A ID="SECTION00318300000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">8</SPAN>.<SPAN CLASS="arabic">3</SPAN> Example Global Configuration</A>
</H3>

<P>
<PRE>
preprocessor http_inspect: global iis_unicode_map unicode.map 1252
</PRE>

<P>

<H3><A ID="SECTION00318400000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">8</SPAN>.<SPAN CLASS="arabic">4</SPAN> Server Configuration</A>
</H3>
There are two types of server configurations: default and by IP address.

<P>

<H4><A ID="SECTION00318410000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">8</SPAN>.<SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">1</SPAN> Default</A>
</H4>

<P>
This configuration supplies the default server configuration for any server
that is not individually configured.  Most of your web servers will most likely
end up using the default configuration.

<P>

<H3><A ID="SECTION00318500000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">8</SPAN>.<SPAN CLASS="arabic">5</SPAN> Example Default Configuration</A>
</H3>
<PRE>
preprocessor http_inspect_server: server default profile all ports { 80 }
</PRE>

<P>

<H4><A ID="SECTION00318510000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">8</SPAN>.<SPAN CLASS="arabic">5</SPAN>.<SPAN CLASS="arabic">1</SPAN> Configuration by IP Address</A>
</H4>
This format is very similar to &ldquo;default&rdquo;, the only difference being that
specific IPs can be configured.

<P>

<H3><A ID="SECTION00318600000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">8</SPAN>.<SPAN CLASS="arabic">6</SPAN> Example IP Configuration</A>
</H3>
<PRE>
preprocessor http_inspect_server: server 10.1.1.1 profile all ports { 80 }
</PRE>

<P>

<H3><A ID="SECTION00318700000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">8</SPAN>.<SPAN CLASS="arabic">7</SPAN> Server Configuration Options</A>
</H3>

<P>
Important: Some configuration options have an argument of `yes' or `no'.  This
argument specifies whether the user wants the configuration option to generate
an HTTP Inspect alert or not.  The `yes/no' argument does not specify whether
the configuration option itself is on or off, only the alerting functionality.
In other words, whether set to `yes' or 'no', HTTP normalization will still
occur, and rules based on HTTP traffic will still trigger.

<P>
 
<DL class="COMPACT">
 <DT> <B><SPAN CLASS="arabic">23</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">profile <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN>all<SPAN CLASS="MATH"><IMG
 STYLE="height: 2.78ex; vertical-align: -0.70ex; " SRC="img5.svg"
 ALT="$\vert$"></SPAN>apache<SPAN CLASS="MATH"><IMG
 STYLE="height: 2.78ex; vertical-align: -0.70ex; " SRC="img5.svg"
 ALT="$\vert$"></SPAN>iis<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN></SPAN>

<P>
Users can configure HTTP Inspect by using pre-defined HTTP server profiles.
Profiles allow the user to easily configure the preprocessor for a certain
type of server, but are not required for proper operation. 

<P>
There are three profiles available: all, apache, and iis.

<P>
 
<DL class="COMPACT">

<DT> <B><SPAN CLASS="arabic">22</SPAN>-<SPAN CLASS="Alph">A</SPAN>. </B> 
<DD><SPAN  CLASS="texttt">all</SPAN>

<P>
The <SPAN  CLASS="texttt">all</SPAN> profile is meant to normalize the URI using most of the common tricks
available.  We alert on the more serious forms of evasions.  This is a great
profile for detecting all types of attacks, regardless of the HTTP server.
<SPAN  CLASS="texttt">profile all</SPAN> sets the configuration options described in Table <A HREF="#profile_all_options"><IMG  ALT="[*]" SRC="crossref.png"></A>.

<P>
<BR><P></P>
<DIV class="CENTER">

<DIV class="CENTER">
<A ID="3217"></A>
<TABLE class="PAD  BORDER" style="">
<CAPTION><STRONG>Table:</STRONG>
Options for the &ldquo;all&rdquo; Profile</CAPTION>
<TR><TH CLASS="LEFT"><SPAN  CLASS="textbf">Option</SPAN></TH>
<TH CLASS="LEFT"><SPAN  CLASS="textbf">Setting</SPAN></TH>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">flow_depth</TD>
<TD CLASS="LEFT">300</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">chunk encoding</TD>
<TD CLASS="LEFT">alert on chunks larger than 500000 bytes</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">iis_unicode_map</TD>
<TD CLASS="LEFT">codepoint map in the global configuration</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">ascii decoding</TD>
<TD CLASS="LEFT">on, alert off</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">multiple slash</TD>
<TD CLASS="LEFT">on, alert off</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">directory normalization</TD>
<TD CLASS="LEFT">on, alert off</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">apache whitespace</TD>
<TD CLASS="LEFT">on, alert off</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">double decoding</TD>
<TD CLASS="LEFT">on, alert on</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">%u decoding</TD>
<TD CLASS="LEFT">on, alert on</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">bare byte decoding</TD>
<TD CLASS="LEFT">on, alert on</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">iis unicode codepoints</TD>
<TD CLASS="LEFT">on, alert on</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">iis backslash</TD>
<TD CLASS="LEFT">on, alert off</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">iis delimiter</TD>
<TD CLASS="LEFT">on, alert off</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">webroot</TD>
<TD CLASS="LEFT">on, alert on</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">non_strict URL parsing</TD>
<TD CLASS="LEFT">on</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">tab_uri_delimiter</TD>
<TD CLASS="LEFT">is set</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
</TABLE>
</DIV>
</DIV>
<BR>

<P>
<DT> <B><SPAN CLASS="arabic">22</SPAN>-<SPAN CLASS="Alph">B</SPAN>. </B> 
<DD><SPAN  CLASS="texttt">apache</SPAN> 

<P>
The <SPAN  CLASS="texttt">apache</SPAN> profile is used for Apache web servers.  This differs from the
<SPAN  CLASS="texttt">iis</SPAN> profile by only accepting UTF-8 standard Unicode encoding and not
accepting backslashes as legitimate slashes, like IIS does.  Apache also
accepts tabs as whitespace.  <SPAN  CLASS="texttt">profile apache</SPAN> sets the configuration
options described in Table <A HREF="#profile_apache_options"><IMG  ALT="[*]" SRC="crossref.png"></A>.

<P>
<BR><P></P>
<DIV class="CENTER">

<DIV class="CENTER">
<A ID="3219"></A>
<TABLE class="PAD  BORDER" style="">
<CAPTION><STRONG>Table:</STRONG>
Options for the <SPAN  CLASS="texttt">apache</SPAN> Profile</CAPTION>
<TR><TH CLASS="LEFT"><SPAN  CLASS="textbf">Option</SPAN></TH>
<TH CLASS="LEFT"><SPAN  CLASS="textbf">Setting</SPAN></TH>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">flow_depth</TD>
<TD CLASS="LEFT">300</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">chunk encoding</TD>
<TD CLASS="LEFT">alert on chunks larger than 500000 bytes</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">ascii decoding</TD>
<TD CLASS="LEFT">on, alert off</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">multiple slash</TD>
<TD CLASS="LEFT">on, alert off</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">directory normalization</TD>
<TD CLASS="LEFT">on, alert off</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">webroot</TD>
<TD CLASS="LEFT">on, alert on</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">apache whitespace</TD>
<TD CLASS="LEFT">on, alert on</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">utf_8 encoding</TD>
<TD CLASS="LEFT">on, alert off</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">non_strict url parsing</TD>
<TD CLASS="LEFT">on</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">tab_uri_delimiter</TD>
<TD CLASS="LEFT">is set</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
</TABLE>
</DIV>
</DIV>
<BR>

<P>
<DT> <B><SPAN CLASS="arabic">22</SPAN>-<SPAN CLASS="Alph">C</SPAN>. </B> 
<DD><SPAN  CLASS="texttt">iis</SPAN>

<P>
The <SPAN  CLASS="texttt">iis</SPAN> profile mimics IIS servers.  So that means we use IIS Unicode
codemaps for each server, %u encoding, bare-byte encoding, double decoding,
backslashes, etc. <SPAN  CLASS="texttt">profile iis</SPAN> sets the configuration options described in
Table <A HREF="#profile_iis_options"><IMG  ALT="[*]" SRC="crossref.png"></A>.

<P>
<BR><P></P>
<DIV class="CENTER">

<DIV class="CENTER">
<A ID="3221"></A>
<TABLE class="PAD  BORDER" style="">
<CAPTION><STRONG>Table:</STRONG>
Options for the <SPAN  CLASS="texttt">iis</SPAN> Profile</CAPTION>
<TR><TH CLASS="LEFT"><SPAN  CLASS="textbf">Option</SPAN></TH>
<TH CLASS="LEFT"><SPAN  CLASS="textbf">Setting</SPAN></TH>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">flow_depth</TD>
<TD CLASS="LEFT">300</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">chunk encoding</TD>
<TD CLASS="LEFT">alert on chunks larger than 500000 bytes</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">iis_unicode_map</TD>
<TD CLASS="LEFT">codepoint map in the global configuration</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">ascii decoding</TD>
<TD CLASS="LEFT">on, alert off</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">multiple slash</TD>
<TD CLASS="LEFT">on, alert off</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">directory normalization</TD>
<TD CLASS="LEFT">on, alert off</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">webroot</TD>
<TD CLASS="LEFT">on, alert on</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">double decoding</TD>
<TD CLASS="LEFT">on, alert on</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">%u decoding</TD>
<TD CLASS="LEFT">on, alert on</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">bare byte decoding</TD>
<TD CLASS="LEFT">on, alert on</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">iis unicode codepoints</TD>
<TD CLASS="LEFT">on, alert on</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">iis backslash</TD>
<TD CLASS="LEFT">on, alert off</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">iis delimiter</TD>
<TD CLASS="LEFT">on, alert on</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">apache whitespace</TD>
<TD CLASS="LEFT">on, alert on</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">non_strict URL parsing</TD>
<TD CLASS="LEFT">on</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
</TABLE>
</DIV>
</DIV>
<BR>

<P>
The default options used by HTTP Inspect do not use a profile and are described 
in Table <A HREF="#default_HTTP_Inspect_options"><IMG  ALT="[*]" SRC="crossref.png"></A>.

<P>
<BR><P></P>
<DIV class="CENTER">

<DIV class="CENTER">
<A ID="3223"></A>
<TABLE class="PAD  BORDER" style="">
<CAPTION><STRONG>Table:</STRONG>
Default HTTP Inspect Options</CAPTION>
<TR><TH CLASS="LEFT"><SPAN  CLASS="textbf">Option</SPAN></TH>
<TH CLASS="LEFT"><SPAN  CLASS="textbf">Setting</SPAN></TH>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">port</TD>
<TD CLASS="LEFT">80</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">flow_depth</TD>
<TD CLASS="LEFT">300</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">chunk encoding</TD>
<TD CLASS="LEFT">alert on chunks larger than 500000 bytes</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">ascii decoding</TD>
<TD CLASS="LEFT">on, alert off</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">utf_8 encoding</TD>
<TD CLASS="LEFT">on, alert off</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">multiple slash</TD>
<TD CLASS="LEFT">on, alert off</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">directory normalization</TD>
<TD CLASS="LEFT">on, alert off</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">webroot</TD>
<TD CLASS="LEFT">on, alert on</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">iis backslash</TD>
<TD CLASS="LEFT">on, alert off</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">apache whitespace</TD>
<TD CLASS="LEFT">on, alert off</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">iis delimiter</TD>
<TD CLASS="LEFT">on, alert off</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">non_strict URL parsing</TD>
<TD CLASS="LEFT">on</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
</TABLE>
</DIV>
</DIV>
<BR>
Profiles must be specified as the first server option and cannot be combined
with any other options except:

<UL>
<LI><SPAN  CLASS="texttt">ports</SPAN>
</LI>
<LI><SPAN  CLASS="texttt">iis_unicode_map</SPAN>
</LI>
<LI><SPAN  CLASS="texttt">allow_proxy_use</SPAN>
</LI>
<LI><SPAN  CLASS="texttt">flow_depth</SPAN>
</LI>
<LI><SPAN  CLASS="texttt">no_alerts</SPAN>
</LI>
<LI><SPAN  CLASS="texttt">inspect_uri_only</SPAN>
</LI>
<LI><SPAN  CLASS="texttt">oversize_dir_length</SPAN> 
</LI>
</UL>
These options must be specified after the <SPAN  CLASS="texttt">profile</SPAN> option. 
</DD>
</DL> 
<P>
</DD>
</DL>
<H3><A ID="SECTION00318800000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">8</SPAN>.<SPAN CLASS="arabic">8</SPAN> Example</A>
</H3>
<PRE>
preprocessor http_inspect_server: server 1.1.1.1 profile all ports { 80 3128 }
</PRE>

<P>
<SPAN  CLASS="texttt">ports <SPAN CLASS="MATH"><IMG
 STYLE="height: 2.78ex; vertical-align: -0.70ex; " SRC="img11.svg"
 ALT="$\{ &lt;$"></SPAN>port<SPAN CLASS="MATH"><IMG
 STYLE="height: 2.78ex; vertical-align: -0.70ex; " SRC="img12.svg"
 ALT="$&gt; [&lt;$"></SPAN>port<SPAN CLASS="MATH"><IMG
 STYLE="height: 2.78ex; vertical-align: -0.70ex; " SRC="img13.svg"
 ALT="$&gt; &lt;...&gt;] \}$"></SPAN></SPAN>

<P>
This is how the user configures which ports to decode on the HTTP server.
Encrypted traffic (SSL) cannot be decoded, so adding port 443 will only
yield encoding false positives.

<P>
<SPAN  CLASS="texttt">iis_unicode_map <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN>map_filename<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN> codemap <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN>integer<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN></SPAN>

<P>
The IIS Unicode map is generated by the program ms_unicode_generator.c.  This
program is located on the Snort.org web site at http://www.snort.org/dl/contrib/
directory.  Executing this program
generates a Unicode map for the system that it was run on.  So, to get the
specific Unicode mappings for an IIS web server, you run this program on that
server and use that Unicode map in this configuration.

<P>
When using this option, the user needs to specify the file that contains the
IIS Unicode map and also specify the Unicode map to use.  For US servers, this
is usually 1252.  But the ms_unicode_generator program tells you which codemap
to use for you server; it's the ANSI code page.  You can select the correct code
page by looking at the available code pages that the ms_unicode_generator
outputs.

<P>
<SPAN  CLASS="texttt">flow_depth <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN>integer<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN></SPAN>

<P>
This specifies the amount of server response payload to inspect.  This option
significantly increases IDS performance because we are ignoring a large part of
the network traffic (HTTP server response payloads).  A small percentage of
Snort rules are targeted at this traffic and a small flow_depth value may
cause false negatives in some of these rules.  Most of these rules target
either the HTTP header, or the content that is likely to be in the first
hundred or so bytes of non-header data.  Headers are usually under 300 bytes
long, but your mileage may vary.

<P>
This value can be set from -1 to 1460. A value of -1 causes Snort to
ignore all server side traffic for ports defined in <SPAN  CLASS="texttt">ports</SPAN>.
Inversely, a value of 0 causes Snort to inspect all HTTP server payloads
defined in <SPAN  CLASS="texttt">ports</SPAN> (note that this will likely slow down IDS
performance).  Values above 0 tell Snort the number of bytes to inspect
in the first packet of the server response.

<P>
<SPAN  CLASS="texttt">ascii <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN>yes<SPAN CLASS="MATH"><IMG
 STYLE="height: 2.78ex; vertical-align: -0.70ex; " SRC="img5.svg"
 ALT="$\vert$"></SPAN>no<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN></SPAN>

<P>
The <SPAN  CLASS="texttt">ascii</SPAN> decode option tells us whether to decode encoded ASCII chars, a.k.a
%2f = /, %2e = ., etc.  It is normal to see ASCII encoding usage in URLs, so it
is recommended that you disable HTTP Inspect alerting for this option.

<P>
<SPAN  CLASS="texttt">utf_8 <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN>yes<SPAN CLASS="MATH"><IMG
 STYLE="height: 2.78ex; vertical-align: -0.70ex; " SRC="img5.svg"
 ALT="$\vert$"></SPAN>no<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN></SPAN>

<P>
The <SPAN  CLASS="texttt">utf-8</SPAN> decode option tells HTTP Inspect to decode standard UTF-8 Unicode
sequences that are in the URI.  This abides by the Unicode standard and only
uses % encoding.  Apache uses this standard, so for any Apache servers, make
sure you have this option turned on.  As for alerting, you may be interested in
knowing when you have a UTF-8 encoded URI, but this will be prone to false
positives as legitimate web clients use this type of encoding.  When <SPAN  CLASS="texttt">utf_8</SPAN> is
enabled, ASCII decoding is also enabled to enforce correct functioning.  

<P>
<SPAN  CLASS="texttt">u_encode <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN>yes<SPAN CLASS="MATH"><IMG
 STYLE="height: 2.78ex; vertical-align: -0.70ex; " SRC="img5.svg"
 ALT="$\vert$"></SPAN>no<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN></SPAN>

<P>
This option emulates the IIS %u encoding scheme.  How the %u encoding scheme
works is as follows:  the encoding scheme is started by a %u followed by 4
characters, like %uxxxx.  The xxxx is a hex-encoded value that correlates to an IIS
Unicode codepoint.  This value can most definitely be ASCII.  An ASCII character is
encoded like %u002f = /, %u002e = ., etc.  If no iis_unicode_map is specified
before or after this option, the default codemap is used.

<P>
You should alert on %u encodings, because we are not aware of any legitimate
clients that use this encoding.  So it is most likely someone trying to be
covert.

<P>
<SPAN  CLASS="texttt">bare_byte <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN>yes<SPAN CLASS="MATH"><IMG
 STYLE="height: 2.78ex; vertical-align: -0.70ex; " SRC="img5.svg"
 ALT="$\vert$"></SPAN>no<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN></SPAN>

<P>
Bare byte encoding is an IIS trick that uses non-ASCII characters as valid values when
decoding UTF-8 values.  This is not in the HTTP standard, as all non-ASCII
values have to be encoded with a %.  Bare byte encoding allows the user to
emulate an IIS server and interpret non-standard encodings correctly.

<P>
The alert on this decoding should be enabled, because there are no legitimate
clients that encode UTF-8 this way since it is non-standard.

<P>
<SPAN  CLASS="texttt">base36 <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN>yes<SPAN CLASS="MATH"><IMG
 STYLE="height: 2.78ex; vertical-align: -0.70ex; " SRC="img5.svg"
 ALT="$\vert$"></SPAN>no<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN></SPAN>

<P>
This is an option to decode base36 encoded chars.  This option is based on of
info from 
http://www.yk.rim.or.jp/&nbsp;shikap/patch/spp_http_decode.patch.

<P>
If %u encoding is enabled, this option will not work.  You have to use the
<SPAN  CLASS="texttt">base36</SPAN> option with the <SPAN  CLASS="texttt">utf_8</SPAN> option.  Don't use the %u option, because base36
won't work.  When <SPAN  CLASS="texttt">base36</SPAN> is enabled, ASCII encoding is also enabled to enforce correct
behavior.

<P>
<SPAN  CLASS="texttt">iis_unicode <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN>yes<SPAN CLASS="MATH"><IMG
 STYLE="height: 2.78ex; vertical-align: -0.70ex; " SRC="img5.svg"
 ALT="$\vert$"></SPAN>no<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN></SPAN>

<P>
The <SPAN  CLASS="texttt">iis_unicode</SPAN> option turns on the Unicode codepoint mapping.  If there is no
iis_unicode_map option specified with the server config, <SPAN  CLASS="texttt">iis_unicode</SPAN> uses the
default codemap.  The <SPAN  CLASS="texttt">iis_unicode</SPAN> option handles the mapping of non-ASCII
codepoints that the IIS server accepts and decodes normal UTF-8 requests.

<P>
You should alert on the <SPAN  CLASS="texttt">iis_unicode option</SPAN>, because it is seen mainly in
attacks and evasion attempts.  When <SPAN  CLASS="texttt">iis_unicode</SPAN> is enabled, ASCII and
UTF-8 decoding are also enabled to enforce correct decoding.  To alert on UTF-8 decoding, you
 must enable also enable <SPAN  CLASS="texttt">utf_8 yes</SPAN>. 

<P>
<SPAN  CLASS="texttt">double_decode <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN>yes<SPAN CLASS="MATH"><IMG
 STYLE="height: 2.78ex; vertical-align: -0.70ex; " SRC="img5.svg"
 ALT="$\vert$"></SPAN>no<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN></SPAN>
The <SPAN  CLASS="texttt">double_decode</SPAN> option is once again IIS-specific and emulates IIS
functionality.  How this works is that IIS does two passes through the request
URI, doing decodes in each one.  In the first pass, it seems that all types of
iis encoding is done: utf-8 unicode, ascii, bare byte, and %u.  In the second
pass, the following encodings are done:  ascii, bare byte, and %u.  We leave out
utf-8 because I think how this works is that the % encoded utf-8 is decoded to
the Unicode byte in the first pass, and then UTF-8 is decoded in the second stage.
Anyway, this is really complex and adds tons of different encodings for one
character.  When <SPAN  CLASS="texttt">double_decode</SPAN> is enabled, so ASCII is also enabled to enforce correct decoding.

<P>
<SPAN  CLASS="texttt">non_rfc_char <SPAN CLASS="MATH"><IMG
 STYLE="height: 2.78ex; vertical-align: -0.70ex; " SRC="img11.svg"
 ALT="$\{ &lt;$"></SPAN>byte<SPAN CLASS="MATH"><IMG
 STYLE="height: 2.78ex; vertical-align: -0.70ex; " SRC="img12.svg"
 ALT="$&gt; [&lt;$"></SPAN>byte ...<SPAN CLASS="MATH"><IMG
 STYLE="height: 2.78ex; vertical-align: -0.70ex; " SRC="img14.svg"
 ALT="$&gt;] \}$"></SPAN></SPAN>

<P>
This option lets users receive an alert if certain non-RFC chars are used in a
request URI.  For instance, a user may not want to see null bytes in the
request URI and we can alert on that.  Please use this option with
care, because you could configure it to say, alert on all `/' or something like
that.  It's flexible, so be careful.

<P>
<SPAN  CLASS="texttt">multi_slash <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN>yes<SPAN CLASS="MATH"><IMG
 STYLE="height: 2.78ex; vertical-align: -0.70ex; " SRC="img5.svg"
 ALT="$\vert$"></SPAN>no<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN></SPAN>

<P>
This option normalizes multiple slashes in a row, so something like:
&ldquo;foo/////////bar&rdquo; get normalized to &ldquo;foo/bar.&rdquo;

<P>
If you want an alert when multiple slashes are seen, then configure with a <SPAN  CLASS="texttt">yes</SPAN>; otherwise, use <SPAN  CLASS="texttt">no</SPAN>.

<P>
<SPAN  CLASS="texttt">iis_backslash <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN>yes<SPAN CLASS="MATH"><IMG
 STYLE="height: 2.78ex; vertical-align: -0.70ex; " SRC="img5.svg"
 ALT="$\vert$"></SPAN>no<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN></SPAN>

<P>
Normalizes backslashes to slashes.  This is again an IIS emulation.  So a
request URI of &ldquo;/foo<SPAN CLASS="MATH"><IMG
 STYLE="height: 2.78ex; vertical-align: -0.70ex; " SRC="img15.svg"
 ALT="$\backslash$"></SPAN>bar&rdquo; gets normalized to &ldquo;/foo/bar.&rdquo;

<P>
<SPAN  CLASS="texttt">directory <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN>yes<SPAN CLASS="MATH"><IMG
 STYLE="height: 2.78ex; vertical-align: -0.70ex; " SRC="img5.svg"
 ALT="$\vert$"></SPAN>no<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN></SPAN>

<P>
This option normalizes directory traversals and self-referential directories.

<P>
The directory:
<PRE> /foo/fake\_dir/../bar
</PRE>
gets normalized to:
<PRE> /foo/bar
</PRE>

<P>
The directory:
<PRE> /foo/./bar
</PRE>
gets normalized to:
<PRE> /foo/bar
</PRE>

<P>
If you want to configure an alert, specify <SPAN  CLASS="texttt">yes</SPAN>, otherwise, specify <SPAN  CLASS="texttt">no</SPAN>.  This alert may give false positives, since some web sites refer to files using directory traversals.

<P>
<SPAN  CLASS="texttt">apache_whitespace <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN>yes<SPAN CLASS="MATH"><IMG
 STYLE="height: 2.78ex; vertical-align: -0.70ex; " SRC="img5.svg"
 ALT="$\vert$"></SPAN>no<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN></SPAN>

<P>
This option deals with the non-RFC standard of using tab for a space delimiter.  Apache
uses this, so if the emulated web server is Apache, enable this
option.  Alerts on this option may be interesting, but may also be false
positive prone.

<P>
<SPAN  CLASS="texttt">iis_delimiter <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN>yes<SPAN CLASS="MATH"><IMG
 STYLE="height: 2.78ex; vertical-align: -0.70ex; " SRC="img5.svg"
 ALT="$\vert$"></SPAN>no<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN></SPAN>

<P>
This started out being IIS-specific, but Apache takes this non-standard
delimiter was well.  Since this is common, we always take this as standard
since the most popular web servers accept it.  But you can still get an alert
on this option.

<P>
<SPAN  CLASS="texttt">chunk_length <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN>non-zero positive integer<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN></SPAN>

<P>
This option is an anomaly detector for abnormally large chunk sizes.  This
picks up the Apache chunk encoding exploits, and may also alert on HTTP
tunneling that uses chunk encoding.

<P>
<SPAN  CLASS="texttt">no_pipeline_req</SPAN>

<P>
This option turns HTTP pipeline decoding off, and is a performance enhancement
if needed.  By default, pipeline requests are inspected for attacks, but when
this option is enabled, pipeline requests are not decoded and analyzed per
HTTP protocol field.  It is only inspected with the generic pattern
matching.

<P>
<SPAN  CLASS="texttt">non_strict</SPAN>

<P>
This option turns on non-strict URI parsing for the broken way in which Apache
servers will decode a URI.  Only use this option on servers that will accept
URIs like this: "get /index.html alsjdfk alsj lj aj  la jsj s<SPAN CLASS="MATH"><IMG
 STYLE="height: 2.78ex; vertical-align: -0.70ex; " SRC="img15.svg"
 ALT="$\backslash$"></SPAN>n".  The
non_strict option assumes the URI is between the first and second space even if
there is no valid HTTP identifier after the second space.

<P>
<SPAN  CLASS="texttt">allow_proxy_use</SPAN>

<P>
By specifying this keyword, the user is allowing proxy use on this server.
This means that no alert will be generated if the <SPAN  CLASS="texttt">proxy_alert</SPAN> global keyword
has been used.  If the proxy_alert keyword is not enabled, then this option
does nothing.  The <SPAN  CLASS="texttt">allow_proxy_use</SPAN> keyword is just a way to suppress
unauthorized proxy use for an authorized server.  

<P>
<SPAN  CLASS="texttt">no_alerts</SPAN>

<P>
This option turns off all alerts that are generated by the HTTP Inspect
preprocessor module.  This has no effect on HTTP rules in the rule set.  No
argument is specified.

<P>
<SPAN  CLASS="texttt">oversize_dir_length <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN>non-zero positive integer<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN></SPAN>

<P>
This option takes a non-zero positive integer as an argument.  The argument
specifies the max char directory length for URL directory.  If a url directory
is larger than this argument size, an alert is generated. A good argument
value is 300 characters.  This should limit the alerts to IDS evasion type attacks,
like whisker -i 4.

<P>
<SPAN  CLASS="texttt">inspect_uri_only</SPAN>

<P>
This is a performance optimization.  When enabled, only the URI portion of HTTP
requests will be inspected for attacks.  As this field usually contains 90-95%
of the web attacks, you'll catch most of the attacks.  So if you need extra
performance, enable this optimization.  It's important to note that if
this option is used without any <SPAN  CLASS="texttt">uricontent</SPAN> rules, then no inspection will take
place.  This is obvious since the URI is only inspected with <SPAN  CLASS="texttt">uricontent</SPAN> rules,
and if there are none available, then there is nothing to inspect.

<P>
For example, if we have the following rule set:

<P>
<PRE>
alert tcp any any -&gt; any 80 ( msg:"content"; content: "foo"; )
</PRE>

<P>
and the we inspect the following URI:
<PRE>
get /foo.htm http/1.0\r\n\r\n
</PRE>

<P>
No alert will be generated when <SPAN  CLASS="texttt">inspect_uri_only</SPAN> is enabled.  The
<SPAN  CLASS="texttt">inspect_uri_only</SPAN> configuration turns off all forms of detection except
<SPAN  CLASS="texttt">uricontent</SPAN> inspection.

<P>
<SPAN  CLASS="texttt">webroot <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN>yes<SPAN CLASS="MATH"><IMG
 STYLE="height: 2.78ex; vertical-align: -0.70ex; " SRC="img5.svg"
 ALT="$\vert$"></SPAN>no<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN></SPAN>

<P>
This option generates an alert when a directory traversal traverses past
the web server root directory.  This generates much fewer false positives than
the directory option, because it doesn't alert on directory traversals that
stay within the web server directory structure.  It only alerts when the
directory traversals go past the web server root directory, which
is associated with certain web attacks.

<P>
<SPAN  CLASS="texttt">tab_uri_delimiter</SPAN>

<P>
This option turns on the use of the tab character (0x09) as a delimiter for
a URI.  Apache accepts tab as a delimiter; IIS does not.  For IIS, a tab in
the URI should be treated as any other character.  Whether this option is on
or not, a tab is treated as whitespace if a space character (0x20) precedes it.
No argument is specified.

<P>
 
<P>

<H3><A ID="SECTION00318900000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">8</SPAN>.<SPAN CLASS="arabic">9</SPAN> Examples</A>
</H3>

<P>
<PRE>
preprocessor http_inspect_server: server 10.1.1.1 \
                        ports { 80 3128 8080 } \
                        flow_depth 0 \
                        ascii no \
                        double_decode yes \
                        non_rfc_char { 0x00 } \
                        chunk_length 500000 \
                        non_strict \
                        no_alerts

preprocessor http_inspect_server: server default \ 
                        ports  { 80 3128 }  \
                        non_strict \
                        non_rfc_char  { 0x00 }  \
                        flow_depth 300  \
                        apache_whitespace yes \
                        directory no \
                        iis_backslash no \
                        u_encode yes \
                        ascii no \
                        chunk_length 500000 \
                        bare_byte yes \
                        double_decode yes \
                        iis_unicode yes \ 
                        iis_delimiter yes \
                        multi_slash no

preprocessor http_inspect_server: server default \
                        profile all \
                        ports { 80 8080 }
</PRE>

<P>

<H2><A ID="SECTION00319000000000000000"></A><A ID="SMTP"></A>
<BR>
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">9</SPAN> SMTP Preprocessor
</H2>

<P>
The SMTP preprocessor is an SMTP decoder for user applications.  Given a data buffer,
SMTP will decode the buffer and find SMTP commands and responses.
It will also mark the command, data header data body sections, and TLS data.

<P>
SMTP handles stateless and stateful processing.  It saves state
between individual packets.  However maintaining correct state is
dependent on the reassembly of the client side of the stream (ie, a
loss of coherent stream data results in a loss of state).

<P>

<H3><A ID="SECTION00319100000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">1</SPAN> Configuration</A>
</H3>

<P>
SMTP has the usual configuration items, such as <SPAN  CLASS="texttt">port</SPAN> and <SPAN  CLASS="texttt">inspection_type</SPAN>.
Also, SMTP command lines can be normalized to remove extraneous spaces.
TLS-encrypted traffic can be ignored, which improves performance.  In addition,
regular mail data can be ignored for an additional performance boost.  Since
so few (none in the current snort rule set) exploits are against mail data,
this is relatively safe to do and can improve the performance of data
inspection.

<P>
The configuration options are described below:

<P>
 
<DL class="COMPACT">

<DT> <B><SPAN CLASS="arabic">24</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">ports { &lt;port&gt; [&lt;port&gt;] ... }</SPAN>

<P>
This specifies on what ports to check for SMTP data.  Typically, this will
include 25 and possibly 465, for encrypted SMTP.

<P>
<DT> <B><SPAN CLASS="arabic">25</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">inspection_type &lt;stateful | stateless&gt;</SPAN>

<P>
Indicate whether to operate in stateful or stateless mode.

<P>
<DT> <B><SPAN CLASS="arabic">26</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">normalize &lt;all | none | cmds&gt;</SPAN>

<P>
This turns on normalization.  Normalization checks for more than one space
character after a command.  Space characters are defined as space (ASCII 0x20)
or tab (ASCII 0x09).

<P>
<SPAN  CLASS="texttt">all</SPAN> checks all commands

<P>
<SPAN  CLASS="texttt">none</SPAN> turns off normalization for all commands.

<P>
<SPAN  CLASS="texttt">cmds</SPAN> just checks commands listed with the <SPAN  CLASS="texttt">normalize_cmds</SPAN> parameter.

<P>
<DT> <B><SPAN CLASS="arabic">27</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">ignore_data</SPAN>

<P>
Ignore data section of mail (except for mail headers) when processing rules.

<P>
<DT> <B><SPAN CLASS="arabic">28</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">ignore_tls_data</SPAN>

<P>
Ignore TLS-encrypted data when processing rules.

<P>
<DT> <B><SPAN CLASS="arabic">29</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">max_command_line_len &lt;int&gt;</SPAN>

<P>
Alert if an SMTP command line is longer than this value.  Absence of this
option or a "0" means never alert on command line length.
RFC 2821 recommends 512 as a maximum command line length.

<P>
<DT> <B><SPAN CLASS="arabic">30</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">max_header_line_len &lt;int&gt;</SPAN>

<P>
Alert if an SMTP DATA header line is longer than this value.  Absence of this
option or a "0" means never alert on data header line length.
RFC 2821 recommends 1024 as a maximum data header line length.

<P>
<DT> <B><SPAN CLASS="arabic">31</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">max_response_line_len &lt;int&gt;</SPAN>

<P>
Alert if an SMTP response line is longer than this value.  Absence of this
option or a "0" means never alert on response line length.
RFC 2821 recommends 512 as a maximum response line length.

<P>
<DT> <B><SPAN CLASS="arabic">32</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">alt_max_command_line_len &lt;int&gt; { &lt;cmd&gt; [&lt;cmd&gt;] }</SPAN>

<P>
Overrides <SPAN  CLASS="texttt">max_command_line_len</SPAN> for specific commands.

<P>
<DT> <B><SPAN CLASS="arabic">33</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">no_alerts</SPAN>

<P>
Turn off all alerts for this preprocessor.

<P>
<DT> <B><SPAN CLASS="arabic">34</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">invalid_cmds { &lt;Space-delimited list of commands&gt; }</SPAN>

<P>
Alert if this command is sent from client side.
Default is an empty list.

<P>
<DT> <B><SPAN CLASS="arabic">35</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">valid_cmds { &lt;Space-delimited list of commands&gt; }</SPAN>

<P>
List of valid commands.  We do not alert on commands in this list.
Default is an empty list, but preprocessor has this list hard-coded:
{ ATRN AUTH BDAT DATA DEBUG EHLO EMAL ESAM ESND ESOM ETRN EVFY EXPN }
{ HELO HELP IDENT MAIL NOOP QUIT RCPT RSET SAML SOML SEND ONEX QUEU }
{ STARTTLS TICK TIME TURN TURNME VERB VRFY X-EXPS X-LINK2STATE }
{ XADR XAUTH XCIR XEXCH50 XGEN XLICENSE XQUE XSTA XTRN XUSR  }

<P>
<DT> <B><SPAN CLASS="arabic">36</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">alert_unknown_cmds</SPAN>

<P>
Alert if we don't recognize command.  Default is off.

<P>
<DT> <B><SPAN CLASS="arabic">37</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">normalize_cmds { &lt;Space-delimited list of commands&gt; }</SPAN>

<P>
Normalize this list of commands Default is { RCPT VRFY EXPN }.

<P>
<DT> <B><SPAN CLASS="arabic">38</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">xlink2state { enable | disable [drop] }</SPAN>

<P>
Enable/disable xlink2state alert.  Drop if alerted.  Default is <SPAN  CLASS="texttt">enable</SPAN>.

<P>
<DT> <B><SPAN CLASS="arabic">39</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">print_cmds</SPAN>

<P>
List all commands understood by the preprocessor.  This not normally
printed out with the configuration because it can print so much data.

<P>
</DD>
</DL> 
<P>

<H3><A ID="SECTION00319200000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">2</SPAN> Example</A>
</H3>

<P>
<PRE>
preprocessor SMTP: \
  ports { 25 } \
  inspection_type stateful \
  normalize cmds \
  normalize_cmds { EXPN VRFY RCPT } \
  ignore_data \
  ignore_tls_data \
  max_command_line_len  512 \
  max_header_line_len   1024 \
  max_response_line_len 512 \
  no_alerts \
  alt_max_command_line_len 300 { RCPT } \
  invalid_cmds { } \
  valid_cmds { } \
  xlink2state { disable } \
  print_cmds
</PRE>

<P>

<H3><A ID="SECTION00319300000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">3</SPAN> Default</A>
</H3>

<P>
<PRE>
preprocessor SMTP: \
  ports { 25 } \
  inspection_type stateful \
  normalize cmds \
  normalize_cmds { EXPN VRFY RCPT } \
  alt_max_command_line_len 260 { MAIL } \
  alt_max_command_line_len 300 { RCPT } \
  alt_max_command_line_len 500 { HELP HELO ETRN } \
  alt_max_command_line_len 255 { EXPN VRFY }
</PRE>

<P>

<H3><A ID="SECTION00319400000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">9</SPAN>.<SPAN CLASS="arabic">4</SPAN> Note</A>
</H3>
<SPAN  CLASS="texttt">RCPT TO:</SPAN> and <SPAN  CLASS="texttt">MAIL FROM:</SPAN> are SMTP commands.  For the preprocessor
configuration, they are referred to as RCPT and MAIL, respectively.
Within the code, the preprocessor actually maps RCPT and MAIL to the
correct command name.

<P>

<H2><A ID="SECTION003110000000000000000"></A><A ID="sub:ftptelnet"></A>
<BR>
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">10</SPAN> FTP/Telnet Preprocessor
</H2>

<P>
FTP/Telnet is an improvement to the Telnet decoder and provides
stateful inspection capability for both FTP and Telnet data
streams.  FTP/Telnet will decode the stream, identifying FTP
commands and responses and Telnet escape sequences and
normalize the fields.  FTP/Telnet works on both client requests
and server responses.

<P>
FTP/Telnet has the capability to handle stateless processing, meaning
it only looks for information on a packet-by-packet basis.  

<P>
The default is to run FTP/Telent in stateful inspection mode, meaning
it looks for information and handles reassembled data correctly.

<P>
FTP/Telnet has a very &ldquo;rich&rdquo; user configuration, similar to that of
HTTP Inspect (See <A HREF="#sub:http-inspect"><IMG  ALT="[*]" SRC="crossref.png"></A>).  Users can configure
individual FTP servers and clients with a variety of options, which
should allow the user to emulate any type of FTP server or FTP Client.
Within FTP/Telnet, there are four areas of configuration: Global,
Telnet, FTP Client, and FTP Server.

<P>

        
        <p><table border="1"><tr><td><b>
        Note:&nbsp;&nbsp;</b>
Some configuration options have an argument of <SPAN  CLASS="texttt">yes</SPAN> or <SPAN  CLASS="texttt">no</SPAN>.
This argument specifies whether the user wants the configuration option to
generate a ftptelnet alert or not.  The presence of the option indicates
the option itself is on, while the <SPAN  CLASS="texttt">yes/no</SPAN> argument applies to the
alerting functionality associated with that option.
        
        </b></td></tr></table></p>

<P>

<H3><A ID="SECTION003110100000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">10</SPAN>.<SPAN CLASS="arabic">1</SPAN> Global Configuration</A>
</H3>

<P>
The global configuration deals with configuration options that determine the
global functioning of FTP/Telnet.  The following example gives the generic
global configuration format:

<P>

<H3><A ID="SECTION003110200000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">10</SPAN>.<SPAN CLASS="arabic">2</SPAN> Format</A>
</H3>
<PRE>
preprocessor ftp_telnet: global \
                        inspection_type stateful \
                        encrypted_traffic yes \
                        check_encrypted
</PRE>

<P>
You can only have a single global configuration, you'll get an error if
you try otherwise.  The FTP/Telnet global configuration must appear
before the other three areas of configuration.

<P>

<H4><A ID="SECTION003110210000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">10</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN> Configuration</A>
</H4>
 
<DL class="COMPACT">
 <DT> <B><SPAN CLASS="arabic">40</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">inspection_type</SPAN>

<P>
This indicates whether to operate in stateful or stateless mode.

<P>
<DT> <B><SPAN CLASS="arabic">41</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">encrypted_traffic <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN>yes|no<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN></SPAN>

<P>
This option enables detection and alerting on encrypted Telnet and
FTP command channels.

<P>

        
        <p><table border="1"><tr><td><b>
        Note:&nbsp;&nbsp;</b>
When <SPAN  CLASS="texttt">inspection_type</SPAN> is in stateless mode, checks for encrypted
traffic will occur on every packet, whereas in stateful mode, a particular
session will be noted as encrypted and not inspected any further.
        
        </b></td></tr></table></p>

<P>
<DT> <B><SPAN CLASS="arabic">42</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">check_encrypted</SPAN>

<P>
Instructs the the preprocessor to continue to check an encrypted session
for a subsequent command to cease encryption.

<P>
</DD>
</DL> 
<P>

<H3><A ID="SECTION003110300000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">10</SPAN>.<SPAN CLASS="arabic">3</SPAN> Example Global Configuration</A>
</H3>

<P>
<PRE>
preprocessor ftp_telnet: global inspection_type stateful encrypted_traffic no
</PRE>

<P>

<H3><A ID="SECTION003110400000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">10</SPAN>.<SPAN CLASS="arabic">4</SPAN> Telnet Configuration</A>
</H3>

<P>
The telnet configuration deals with configuration options that determine the
functioning of the Telnet portion of the preprocessor.  The following
example gives the generic telnet configuration format:

<P>

<H3><A ID="SECTION003110500000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">10</SPAN>.<SPAN CLASS="arabic">5</SPAN> Format</A>
</H3>
<PRE>
preprocessor ftp_telnet_protocol: telnet \
                        ports { 23 } \
                        normalize \
                        ayt_attack_thresh 6 \
                        detect_anomalies
</PRE>

<P>
There should  only be a single telnet configuration, and subsequent instances
will override previously set values.

<P>

<H4><A ID="SECTION003110510000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">10</SPAN>.<SPAN CLASS="arabic">5</SPAN>.<SPAN CLASS="arabic">1</SPAN> Configuration</A>
</H4>
 
<DL class="COMPACT">
 <DT> <B><SPAN CLASS="arabic">43</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">ports <SPAN CLASS="MATH"><IMG
 STYLE="height: 2.78ex; vertical-align: -0.70ex; " SRC="img11.svg"
 ALT="$\{ &lt;$"></SPAN>port<SPAN CLASS="MATH"><IMG
 STYLE="height: 2.78ex; vertical-align: -0.70ex; " SRC="img12.svg"
 ALT="$&gt; [&lt;$"></SPAN>port<SPAN CLASS="MATH"><IMG
 STYLE="height: 2.78ex; vertical-align: -0.70ex; " SRC="img13.svg"
 ALT="$&gt; &lt;...&gt;] \}$"></SPAN></SPAN>

<P>
This is how the user configures which ports to decode as telnet traffic.
SSH tunnels cannot be decoded, so adding port 22 will only yield false
positives.  Typically port 23 will be included.

<P>
<DT> <B><SPAN CLASS="arabic">44</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">normalize</SPAN>

<P>
This option tells the preprocessor to normalize the telnet traffic
by eliminating the telnet escape sequences.  It functions similarly
to its predecessor, the telnet_decode preprocessor.  Rules written
with 'raw' content options will ignore the normailzed buffer that
is created when this option is in use.

<P>
<DT> <B><SPAN CLASS="arabic">45</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">ayt_attack_thresh <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN> number <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN></SPAN>

<P>
This option causes the preprocessor to alert when the number of consecutive
telnet Are You There (AYT) commands reaches the number specified.  It
is only applicable when the mode is stateful.

<P>
<DT> <B><SPAN CLASS="arabic">46</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">detect_anomalies</SPAN>

<P>
In order to support certain options, Telnet supports subnegotiation. Per the
Telnet RFC, subnegotiation begins with SB (subnegotiation begin) and must
end with an SE (subnegotiation end). However, certain implementations of
Telnet servers will ignore the SB without a cooresponding SE. This is
anomalous behavior which could be an evasion case. Being that FTP uses the
Telnet protocol on the control connection, it is also susceptible to this
behavior. The <SPAN  CLASS="texttt">detect_anomalies</SPAN> option enables alerting on Telnet SB without
the corresponding SE.

<P>
</DD>
</DL> 
<P>

<H3><A ID="SECTION003110600000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">10</SPAN>.<SPAN CLASS="arabic">6</SPAN> Example Telnet Configuration</A>
</H3>
<PRE>
preprocessor ftp_telnet_protocol: telnet ports { 23 } normalize ayt_attack_thresh 6
</PRE>

<P>

<H3><A ID="SECTION003110700000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">10</SPAN>.<SPAN CLASS="arabic">7</SPAN> FTP Server Configuration</A>
</H3>

<P>
There are two types of FTP server configurations: default and by IP address.

<P>

<H4><A ID="SECTION003110710000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">10</SPAN>.<SPAN CLASS="arabic">7</SPAN>.<SPAN CLASS="arabic">1</SPAN> Default</A>
</H4>

<P>
This configuration supplies the default server configuration for any FTP server
that is not individually configured.  Most of your FTP servers will most
likely end up using the default configuration.

<P>

<H3><A ID="SECTION003110800000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">10</SPAN>.<SPAN CLASS="arabic">8</SPAN> Example Default FTP Server Configuration</A>
</H3>
<PRE>
preprocessor ftp_telnet_protocol: ftp server default ports { 21 }
</PRE>

<P>

<H4><A ID="SECTION003110810000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">10</SPAN>.<SPAN CLASS="arabic">8</SPAN>.<SPAN CLASS="arabic">1</SPAN> Configuration by IP Address</A>
</H4>
This format is very similar to &ldquo;default&rdquo;, the only difference being that
specific IPs can be configured.

<P>

<H3><A ID="SECTION003110900000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">10</SPAN>.<SPAN CLASS="arabic">9</SPAN> Example IP specific FTP Server Configuration</A>
</H3>
<PRE>
preprocessor _telnet_protocol: ftp server 10.1.1.1 ports { 21 } ftp_cmds { XPWD XCWD }
</PRE>

<P>

<H3><A ID="SECTION0031101000000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">10</SPAN>.<SPAN CLASS="arabic">10</SPAN> FTP Server Configuration Options</A>
</H3>

<P>
 
<DL class="COMPACT">
 <DT> <B><SPAN CLASS="arabic">47</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">ports <SPAN CLASS="MATH"><IMG
 STYLE="height: 2.78ex; vertical-align: -0.70ex; " SRC="img11.svg"
 ALT="$\{ &lt;$"></SPAN>port<SPAN CLASS="MATH"><IMG
 STYLE="height: 2.78ex; vertical-align: -0.70ex; " SRC="img12.svg"
 ALT="$&gt; [&lt;$"></SPAN>port<SPAN CLASS="MATH"><IMG
 STYLE="height: 2.78ex; vertical-align: -0.70ex; " SRC="img13.svg"
 ALT="$&gt; &lt;...&gt;] \}$"></SPAN></SPAN>

<P>
This is how the user configures which ports to decode as FTP command
channel traffic.  Typically port 21 will be included.

<P>
<DT> <B><SPAN CLASS="arabic">48</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">print_cmds</SPAN>

<P>
During initialization, this option causes the preprocessor to print the
configuration for each of the FTP commands for this server.  

<P>
<DT> <B><SPAN CLASS="arabic">49</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">ftp_cmds <!-- MATH
 $\{ cmd [cmd] \}$
 -->
<SPAN CLASS="MATH"><IMG
 STYLE="height: 2.78ex; vertical-align: -0.70ex; " SRC="img16.svg"
 ALT="$\{ cmd [cmd] \}$"></SPAN> </SPAN>

<P>
The preprocessor is configured to alert when it sees an FTP command
that is not allowed by the server.

<P>
This option specifies a list of additional commands allowed by this server,
outside of the default FTP command set as specified in RFC 959.  This
may be used to allow the use of the 'X' commands identified in RFC 775,
as well as any additional commands as needed.

<P>
For example:

<P>
<PRE>
ftp_cmds { XPWD XCWD XCUP XMKD XRMD }
</PRE>

<P>
<DT> <B><SPAN CLASS="arabic">50</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">def_max_param_len <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN>number<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN></SPAN>

<P>
This specifies the default maximum allowed parameter length for an
FTP command.  It can be used as a basic buffer overflow detection.

<P>
<DT> <B><SPAN CLASS="arabic">51</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">alt_max_param_len <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN>number<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"> <!-- MATH
 $\{ cmd [cmd] \}$
 -->
<IMG
 STYLE="height: 2.78ex; vertical-align: -0.70ex; " SRC="img16.svg"
 ALT="$\{ cmd [cmd] \}$"></SPAN></SPAN>

<P>
This specifies the maximum allowed parameter length for the specified
FTP command(s).  It can be used as a more specific buffer overflow
detection.  For example the USER command &ndash; usernames may be no longer
than 16 bytes, so the appropriate configuration would be:

<P>
<PRE>
alt_max_param_len 16 { USER }
</PRE>

<P>
<DT> <B><SPAN CLASS="arabic">52</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">chk_str_fmt <!-- MATH
 $\{ cmd [cmd] \}$
 -->
<SPAN CLASS="MATH"><IMG
 STYLE="height: 2.78ex; vertical-align: -0.70ex; " SRC="img16.svg"
 ALT="$\{ cmd [cmd] \}$"></SPAN></SPAN>

<P>
This option causes a check for string format attacks in the specified
commands. 

<P>
<DT> <B><SPAN CLASS="arabic">53</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">cmd_validity cmd <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN> fmt <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN></SPAN>

<P>
This option specifies the valid format for parameters of a
given command.

<P>
fmt must be enclosed in <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img17.svg"
 ALT="$&lt;&gt;$"></SPAN>'s and may contain the following:

<P>
<DIV class="CENTER">
<TABLE class="PAD  BORDER" style="">
<TR><TH CLASS="LEFT"><SPAN  CLASS="textbf">Value</SPAN></TH>
<TH CLASS="LEFT"><SPAN  CLASS="textbf">Description</SPAN></TH>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">int</TD>
<TD CLASS="LEFT">Parameter must be an integer</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">number</TD>
<TD CLASS="LEFT">Parameter must be an integer between 1 and 255</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">char _chars</TD>
<TD CLASS="LEFT">Parameter must be a single character, one of _chars</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">date _datefmt</TD>
<TD CLASS="LEFT">Parameter follows format specified, where:</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><TABLE class="PAD  BORDER" style="">
<TR><TD CLASS="LEFT">#</TD>
<TD CLASS="LEFT">Number</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=184>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">C</TD>
<TD CLASS="LEFT">Character</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=184>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN CLASS="MATH"><IMG
 STYLE="height: 2.78ex; vertical-align: -0.70ex; " SRC="img18.svg"
 ALT="$[]$"></SPAN></TD>
<TD CLASS="LEFT">optional format enclosed</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=184>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN CLASS="MATH"><IMG
 STYLE="height: 2.78ex; vertical-align: -0.70ex; " SRC="img5.svg"
 ALT="$\vert$"></SPAN></TD>
<TD CLASS="LEFT">OR</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=184>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN CLASS="MATH"><IMG
 STYLE="height: 2.78ex; vertical-align: -0.70ex; " SRC="img19.svg"
 ALT="$\{\}$"></SPAN></TD>
<TD CLASS="LEFT">choice of options</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=184>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">other</TD>
<TD CLASS="LEFT">literal (ie, . + -)</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=184>&nbsp;</TD>
</TR>
</TABLE></TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">string</TD>
<TD CLASS="LEFT">Parameter is a string (effectively unrestricted)</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT">host_port</TD>
<TD CLASS="LEFT">Parameter must be a host/port specified, per RFC 959</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN CLASS="MATH"><IMG
 STYLE="height: 2.78ex; vertical-align: -0.70ex; " SRC="img19.svg"
 ALT="$\{\}$"></SPAN>, <SPAN CLASS="MATH"><IMG
 STYLE="height: 2.78ex; vertical-align: -0.70ex; " SRC="img5.svg"
 ALT="$\vert$"></SPAN></TD>
<TD CLASS="LEFT">One of choices enclosed within, separated by <SPAN CLASS="MATH"><IMG
 STYLE="height: 2.78ex; vertical-align: -0.70ex; " SRC="img5.svg"
 ALT="$\vert$"></SPAN></TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
<TR><TD CLASS="LEFT"><SPAN CLASS="MATH"><IMG
 STYLE="height: 2.78ex; vertical-align: -0.70ex; " SRC="img18.svg"
 ALT="$[]$"></SPAN></TD>
<TD CLASS="LEFT">Optional value enclosed within</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT">&nbsp;</TD>
<TD CLASS="LEFT TOP"  WIDTH=323>&nbsp;</TD>
</TR>
</TABLE>
</DIV>

<P>
Examples of the cmd_validity option are shown below.  These examples are
the default checks, per RFC 959 and others performed by the preprocessor.

<P>
<PRE>
cmd_validity MODE &lt;char SBC&gt;
cmd_validity STRU &lt;char FRP&gt;
cmd_validity ALLO &lt; int [ char R int ] &gt;
cmd_validity TYPE &lt; { char AE [ char NTC ] | char I | char L [ number ] } &gt;
cmd_validity PORT &lt; host_port &gt;
</PRE>

<P>
A cmd_validity line can be used to override these defaults and/or add
a check for other commands.

<P>
<PRE>
# This allows additional modes, including mode Z which allows for
# zip-style compression.
cmd_validity MODE &lt; char ASBCZ &gt;

# Allow for a date in the MDTM command.
cmd_validity MDTM &lt; [ date nnnnnnnnnnnnnn[.n[n[n]]] ] string &gt;
</PRE>

<P>
MDTM is an off case that is worth discussing.

<P>
While not part of an established standard, certain FTP servers accept
MDTM commands that set the modification time on a file.  The most common
among servers that do, accept a format using YYYYMMDDHHmmss[.uuu].  Some
others accept a format using YYYYMMDDHHmmss[+|-]TZ format.  The example
above is for the first case (time format as specified in
http://www.ietf.org/internet-drafts/draft-ietf-ftpext-mlst-16.txt)

<P>
To check validity for a server that uses the TZ format, use the following:

<P>
<PRE>
cmd_validity MDTM &lt; [ date nnnnnnnnnnnnnn[{+|-}n[n]] ] string &gt;
</PRE>

<P>
<DT> <B><SPAN CLASS="arabic">54</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">telnet_cmds <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN>yes<SPAN CLASS="MATH"><IMG
 STYLE="height: 2.78ex; vertical-align: -0.70ex; " SRC="img5.svg"
 ALT="$\vert$"></SPAN>no<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN></SPAN>

<P>
This option turns on detection and alerting when telnet escape sequences are
seen on the FTP command channel.  Injection of telnet escape sequences
could be used as an evasion attempt on an FTP command channel.

<P>
<DT> <B><SPAN CLASS="arabic">55</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">data_chan</SPAN>

<P>
This option causes the rest of snort (rules, other preprocessors) to
ignore FTP data channel connections.  Using this option means that
<SPAN  CLASS="textbf">NO INSPECTION</SPAN> other than TCP state will be performed on FTP
data transfers.  It can be used to improve performance, especially with
large file transfers from a trusted source.   If your rule set includes
virus-type rules, it is recommended that this option not be used.

<P>
</DD>
</DL> 
<P>

<H3><A ID="SECTION0031101100000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">10</SPAN>.<SPAN CLASS="arabic">11</SPAN> FTP Client Configuration</A>
</H3>

<P>
Similar to the FTP Server configuration, the FTP client configurations
has two types: default, and by IP address.

<P>

<H4><A ID="SECTION0031101110000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">10</SPAN>.<SPAN CLASS="arabic">11</SPAN>.<SPAN CLASS="arabic">1</SPAN> Default</A>
</H4>

<P>
This configuration supplies the default client configuration for any FTP
client that is not individually configured.  Most of your FTP clients will
most likely end up using the default configuration.

<P>

<H3><A ID="SECTION0031101200000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">10</SPAN>.<SPAN CLASS="arabic">12</SPAN> Example Default FTP Client Configuration</A>
</H3>
<PRE>
preprocessor ftp_telnet_protocol: ftp client default bounce no max_resp_len 200
</PRE>

<P>

<H4><A ID="SECTION0031101210000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">10</SPAN>.<SPAN CLASS="arabic">12</SPAN>.<SPAN CLASS="arabic">1</SPAN> Configuration by IP Address</A>
</H4>

<P>
This format is very similar to &ldquo;default&rdquo;, the only difference being that
specific IPs can be configured.

<P>

<H3><A ID="SECTION0031101300000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">10</SPAN>.<SPAN CLASS="arabic">13</SPAN> Example IP specific FTP Client Configuration</A>
</H3>
<PRE>
preprocessor ftp_telnet_protocol: ftp client 10.1.1.1 bounce yes max_resp_len 500
</PRE>

<P>

<H3><A ID="SECTION0031101400000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">10</SPAN>.<SPAN CLASS="arabic">14</SPAN> FTP Client Configuration Options</A>
</H3>

<P>
 
<DL class="COMPACT">
 <DT> <B><SPAN CLASS="arabic">56</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">max_resp_len <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN>number<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN></SPAN>

<P>
This specifies the maximum allowed response length to an FTP command
accepted by the client.  It can be used as a basic buffer overflow
detection.

<P>
<DT> <B><SPAN CLASS="arabic">57</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">bounce <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN>yes|no<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN></SPAN>

<P>
This option turns on detection and alerting of FTP bounce attacks.
An FTP bounce attack occurs when the FTP PORT command is issued and the
specified host does not match the host of the client.

<P>
<DT> <B><SPAN CLASS="arabic">58</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">bounce_to <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN> CIDR,[port<SPAN CLASS="MATH"><IMG
 STYLE="height: 2.78ex; vertical-align: -0.70ex; " SRC="img5.svg"
 ALT="$\vert$"></SPAN>portlow,porthi] <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN></SPAN>

<P>
When the bounce option is turned on, this allows the PORT command to use
the IP address (in CIDR format) and port (or inclusive port range)
without generating an alert.  It can be used to deal with proxied
FTP connections where the FTP data channel is different from the client.

<P>
A few examples:

<P>

<UL>
<LI>Allow bounces to 192.162.1.1 port 20020 &ndash; ie, the use of
<SPAN  CLASS="texttt">PORT 192,168,1,1,78,52</SPAN>.

<P>
<PRE>
bounce_to { 192.168.1.1,20020 }
</PRE>

<P>
</LI>
<LI>Allow bounces to 192.162.1.1 ports 20020 through 20040 &ndash; ie,
the use of <SPAN  CLASS="texttt">PORT 192,168,1,1,78,xx</SPAN>, where xx is 52 through 72
inclusive.

<P>
<PRE>
bounce_to { 192.168.1.1,20020,20040 }
</PRE>

<P>
</LI>
<LI>Allow bounces to 192.162.1.1 port 20020 and 192.168.1.2 port 20030.

<P>
<PRE>
bounce_to { 192.168.1.1,20020 192.168.1.2,20030}
</PRE>

<P>
</LI>
</UL>

<P>
<DT> <B><SPAN CLASS="arabic">59</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">telnet_cmds <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN>yes|no<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN></SPAN>

<P>
This option turns on detection and alerting when telnet escape sequences are
seen on the FTP command channel.  Injection of telnet escape sequences
could be used as an evasion attempt on an FTP command channel.

<P>
</DD>
</DL> 
<P>

<H3><A ID="SECTION0031101500000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">10</SPAN>.<SPAN CLASS="arabic">15</SPAN> Examples/Default Configuration from snort.conf</A>
</H3>

<P>
<PRE>
preprocessor ftp_telnet: global \
            encrypted_traffic yes \
            inspection_type stateful

preprocessor ftp_telnet_protocol: telnet \
            normalize \
            ayt_attack_thresh 200

# This is consistent with the FTP rules as of 18 Sept 2004.
# Set CWD to allow parameter length of 200
# MODE has an additional mode of Z (compressed)
# Check for string formats in USER &amp; PASS commands
# Check MDTM commands that set modification time on the file.
preprocessor ftp_telnet_protocol: ftp server default \
            def_max_param_len 100 \
            alt_max_param_len 200 { CWD } \
            cmd_validity MODE &lt; char ASBCZ &gt; \
            cmd_validity MDTM &lt; [ date nnnnnnnnnnnnnn[.n[n[n]]] ] string &gt; \
            chk_str_fmt { USER PASS RNFR RNTO SITE MKD } \
            telnet_cmds yes \
            data_chan

preprocessor ftp_telnet_protocol: ftp client default \
            max_resp_len 256 \
            bounce yes \
            telnet_cmds yes
</PRE>

<P>

<H2><A ID="SECTION003111000000000000000"></A><A ID="sub:ssh"></A>
<BR>
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">11</SPAN> SSH
</H2>

<P>
The SSH preprocessor detects the following exploits: Gobbles, CRC 32, Secure
CRT, and the Protocol Mismatch exploit.

<P>
Both Gobbles and CRC 32 attacks occur after the key exchange, and are therefore
encrypted.  Both attacks involve sending a large payload (20kb+) to the server
immediately after the authentication challenge.  To detect the attacks, the SSH
preprocessor counts the number of bytes transmitted to the server.  If those
bytes exceed a predefined limit within a predefined number of packets, an
alert is generated.  Since Gobbles only effects SSHv2 and CRC 32 only effects
SSHv1, the SSH version string exchange is used to distinguish the attacks.

<P>
The Secure CRT and protocol mismatch exploits are observable before the key
exchange.

<P>

<H3><A ID="SECTION003111100000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">11</SPAN>.<SPAN CLASS="arabic">1</SPAN> Configuration</A>
</H3>

<P>
By default, all alerts are enabled and the preprocessor checks traffic on port
22.

<P>
The available configuration options are described below.

<P>
 
<DL class="COMPACT">

<DT> <B><SPAN CLASS="arabic">60</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">server_ports <SPAN CLASS="MATH"><IMG
 STYLE="height: 2.78ex; vertical-align: -0.70ex; " SRC="img11.svg"
 ALT="$\{ &lt;$"></SPAN>port<SPAN CLASS="MATH"><IMG
 STYLE="height: 2.78ex; vertical-align: -0.70ex; " SRC="img12.svg"
 ALT="$&gt; [&lt;$"></SPAN>port<SPAN CLASS="MATH"><IMG
 STYLE="height: 2.78ex; vertical-align: -0.70ex; " SRC="img13.svg"
 ALT="$&gt; &lt;...&gt;] \}$"></SPAN></SPAN>

<P>
This option specifies which ports the SSH preprocessor should inspect traffic
to.

<P>
<DT> <B><SPAN CLASS="arabic">61</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">max_encrypted_packets <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN> number <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN></SPAN>

<P>
Specifies the number of unanswered packets to allow before alerting on Gobbles
or CRC 32.  In Gobbles or CRC 32, several large packets will be transmitted
immediately after the authentication challenge.  max_encrypted_packets should
be used in combination with max_client_bytes.

<P>
<DT> <B><SPAN CLASS="arabic">62</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">max_client_bytes <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN> number <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN></SPAN>

<P>
The maximum number of bytes allowed to be transferred across
max_encrypted_packets packets before alerting on Gobbles or CRC 32.

<P>
<DT> <B><SPAN CLASS="arabic">63</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">autodetect</SPAN>

<P>
Attempt to automatically detect SSH.

<P>
<DT> <B><SPAN CLASS="arabic">64</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">disable_gobbles</SPAN>

<P>
Disables checking for the Gobbles exploit.

<P>
<DT> <B><SPAN CLASS="arabic">65</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">disable_ssh1crc32</SPAN>

<P>
Disables checking for the CRC 32 exploit.

<P>
<DT> <B><SPAN CLASS="arabic">66</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">disable_srvoverflow</SPAN>

<P>
Disables checking for the Secure CRT exploit.

<P>
<DT> <B><SPAN CLASS="arabic">67</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">disable_protomismatch</SPAN>

<P>
Disables checking for the Protocol Mismatch exploit.

<P>
<DT> <B><SPAN CLASS="arabic">68</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">disable_badmsgdir</SPAN>

<P>
Disable alerts for traffic flowing the wrong direction. For instance, if the
presumed server generates client traffic, or if a client generates server
traffic.

<P>
<DT> <B><SPAN CLASS="arabic">69</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">disable_paysize</SPAN>

<P>
Disables alerts for invalid payload sizes.

<P>
<DT> <B><SPAN CLASS="arabic">70</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">disable_recognition</SPAN>

<P>
Disable alerts for non-SSH traffic on SSH ports.

<P>
</DD>
</DL> 
<P>
The SSH preprocessor should work by default.  After max_client_packets is
reached, the preprocessor will stop processing traffic for a given session.
If Gobbles or CRC 32 false positive, try increasing the number of required
client bytes with max_client_bytes.

<P>

<H3><A ID="SECTION003111200000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">11</SPAN>.<SPAN CLASS="arabic">2</SPAN> Examples/Default Configuration from snort.conf</A>
</H3>

<P>
Looks for attacks on SSH server port 22.  Alerts at 19600 bytes
within 20 encrypted packets for the Gobbles/CRC32 exploits.

<P>
<PRE>
preprocessor ssh: server_ports { 22 } \
                  max_client_bytes 19600 \
                  max_encrypted_packets 20
</PRE>

<P>

<H2><A ID="SECTION003112000000000000000"></A><A ID="sub:dcerpc"></A>
<BR>
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">12</SPAN> DCE/RPC
</H2>

<P>
The dcerpc preprocessor detects and decodes SMB and DCE/RPC traffic.
It is primarily interested in DCE/RPC data, and only decodes SMB
to get at the DCE/RPC data carried by the SMB layer.

<P>
Currently, the preprocessor only handles reassembly of fragmentation
at both the SMB and DCE/RPC layer.  Snort rules can be evaded by
using both types of fragmentation; with the preprocessor enabled
the rules are given a buffer with a reassembled SMB or DCE/RPC
packet to examine.

<P>
At the SMB layer, only fragmentation using WriteAndX is currently
reassembled.  Other methods will be handled in future versions of
the preprocessor.

<P>
Autodetection of SMB is done by looking for "<code>\xFFSMB</code>" at the
start of the SMB data, as well as checking the NetBIOS header (which
is always present for SMB) for the type "SMB Session".

<P>
Autodetection of DCE/RPC is not as reliable.  Currently, two bytes are
checked in the packet.  Assuming that the data is a DCE/RPC header,
one byte is checked for DCE/RPC version (5) and another for the type
"DCE/RPC Request".  If both match, the preprocessor proceeds with that
assumption that it is looking at DCE/RPC data.  If subsequent checks
are nonsensical, it ends processing.

<P>

<H3><A ID="SECTION003112100000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">12</SPAN>.<SPAN CLASS="arabic">1</SPAN> Configuration</A>
</H3>

<P>
The proprocessor has several configuration options.  They are described
below:

<P>
The configuration options are described below:

<P>
 
<DL class="COMPACT">

<DT> <B><SPAN CLASS="arabic">71</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">autodetect</SPAN>
Ignore configured ports - examine all packets in attempt to determine
SMB or DCE/RPC traffic.  Default is on

<P>
<DT> <B><SPAN CLASS="arabic">72</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">ports smb { <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN>port<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN> [&lt;<SPAN CLASS="MATH"><IMG
 STYLE="height: 2.34ex; vertical-align: -0.57ex; " SRC="img20.svg"
 ALT="$port$"></SPAN>&gt; &lt;...&gt;] } dcerpc { <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN>port<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN> [&lt;<SPAN CLASS="MATH"><IMG
 STYLE="height: 2.34ex; vertical-align: -0.57ex; " SRC="img20.svg"
 ALT="$port$"></SPAN>&gt; &lt;...&gt;] } </SPAN>
Ports that the preprocessor monitors for SMB and DCE/RPC traffic.
Default is not configured (although default values would be 139
and 445 for SMB and 35 for DCE/RPC).

<P>
<DT> <B><SPAN CLASS="arabic">73</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">disable_smb_frag</SPAN>
Do not attempt to reassemble SMB fragmentation.   Default is off
(not configured).

<P>
<DT> <B><SPAN CLASS="arabic">74</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">disable_dcerpc_frag</SPAN>
Do not attempt to reassemble DCE/RPC fragmentation.   Default is off
(not configured).

<P>
<DT> <B><SPAN CLASS="arabic">75</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">max_frag_size <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN>number<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN></SPAN>
Maximum reassembled fragment size, in bytes.  Default 3000 bytes.

<P>
<DT> <B><SPAN CLASS="arabic">76</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">memcap <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img1.svg"
 ALT="$&lt;$"></SPAN>number<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN></SPAN>
Maximum amount of memory available to the DCE/RPC preprocessor, in
kilobytes.  Default 100000.

<P>
</DD>
</DL> 
<P>

<H3><A ID="SECTION003112200000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">12</SPAN>.<SPAN CLASS="arabic">2</SPAN> Alerts</A>
</H3>
There is currently only one alert, which is triggered when the preprocessor
has reached the <SPAN  CLASS="texttt">memcap</SPAN> limit for memory allocation.  The
alert is gid 130, sid 1.

<P>

<H3><A ID="SECTION003112300000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">12</SPAN>.<SPAN CLASS="arabic">3</SPAN> Summary</A>
</H3>
At the current time, there is not much to do with the dcerpc preprocessor
other than turn it on and let it reassemble fragmented DCE/RPC packets.

<P>

<H3><A ID="SECTION003112400000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">12</SPAN>.<SPAN CLASS="arabic">4</SPAN> Configuration Examples</A>
</H3>

<P>
Do not reassemble SMB fragmentation.

<P>
<PRE>
preprocessor dcerpc: \
        autodetect \
        disable_smb_frag \
        max_frag_size 4000
</PRE>

<P>
Specify specific ports, no autodetect.  Do not reassemble SMB fragmentation.

<P>
<PRE>
preprocessor dcerpc: \
        ports smb { 139 445 } dcerpc { 135 } \
        disable_dcerpc_frag \
        memcap 50000
</PRE>

<P>

<H3><A ID="SECTION003112500000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">12</SPAN>.<SPAN CLASS="arabic">5</SPAN> Default Configuration from snort.conf</A>
</H3>

<P>
Autodetect SMB and DCE/RPC traffic.  Reassembly of SMB and DCE/RPC
fragmentation.

<P>
<PRE>
preprocessor dcerpc: \
        autodetect \
        max_frag_size 3000 \
        memcap 100000
</PRE>

<P>

<H2><A ID="SECTION003113000000000000000"></A><A ID="sub:dns"></A>
<BR>
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">13</SPAN> DNS
</H2>

<P>
The DNS preprocessor decodes DNS Responses and can detect the
following exploits: DNS Client RData Overflow, Obsolete Record
Types, and Experimental Record Types.

<P>
DNS looks are DNS Response traffic over UDP and TCP and it requires
Stream preprocessor to be enabled for TCP decoding.

<P>

<H3><A ID="SECTION003113100000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">13</SPAN>.<SPAN CLASS="arabic">1</SPAN> Configuration</A>
</H3>

<P>
By default, all alerts are disabled and the preprocessor checks traffic
on port 53.

<P>
The available configuration options are described below.

<P>
 
<DL class="COMPACT">

<DT> <B><SPAN CLASS="arabic">77</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">ports <SPAN CLASS="MATH"><IMG
 STYLE="height: 2.78ex; vertical-align: -0.70ex; " SRC="img11.svg"
 ALT="$\{ &lt;$"></SPAN>port<SPAN CLASS="MATH"><IMG
 STYLE="height: 2.78ex; vertical-align: -0.70ex; " SRC="img12.svg"
 ALT="$&gt; [&lt;$"></SPAN>port<SPAN CLASS="MATH"><IMG
 STYLE="height: 2.78ex; vertical-align: -0.70ex; " SRC="img13.svg"
 ALT="$&gt; &lt;...&gt;] \}$"></SPAN></SPAN>

<P>
This option specifies the source ports that the DNS preprocessor should
inspect traffic.

<P>
<DT> <B><SPAN CLASS="arabic">78</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">enable_obsolete_types</SPAN>

<P>
Alert on Obsolete (per RFC 1035) Record Types

<P>
<DT> <B><SPAN CLASS="arabic">79</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">enable_experimental_types</SPAN>

<P>
Alert on Experimental (per RFC 1035) Record Types

<P>
<DT> <B><SPAN CLASS="arabic">80</SPAN>.</B> 
<DD><SPAN  CLASS="texttt">enable_rdata_overflow</SPAN>

<P>
Check for DNS Client RData TXT Overflow

<P>
</DD>
</DL> 
<P>
The DNS preprocessor does nothing if none of the 3 vulnerabilities
it checks for are enabled.  It will not operate on TCP sessions
picked up midstream, and it will cease operation on a session if it
loses state because of missing data (dropped packets).

<P>

<H3><A ID="SECTION003113200000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">13</SPAN>.<SPAN CLASS="arabic">2</SPAN> Examples/Default Configuration from snort.conf</A>
</H3>

<P>
Looks for traffic on DNS server port 53.  Check for the DNS Client RData
overflow vulnerability.  Do not alert on obsolete or experimental RData
record types.

<P>
<PRE>
preprocessor dns: server_ports { 53 } \
                  enable_rdata_overflow
</PRE>

<P>

<DIV CLASS="navigation"><HR>
<!--Navigation Panel-->
<A
 HREF="node12.html">
<IMG WIDTH="37" HEIGHT="24" ALT="next" SRC="next.png"></A> 
<A
 HREF="node10.html">
<IMG WIDTH="26" HEIGHT="24" ALT="up" SRC="up.png"></A> 
<A
 HREF="node10.html">
<IMG WIDTH="63" HEIGHT="24" ALT="previous" SRC="prev.png"></A> 
<A ID="tex2html377"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALT="contents" SRC="contents.png"></A>  
<BR>
<B> Next:</B> <A
 HREF="node12.html">2.2 Event Thresholding</A>
<B> Up:</B> <A
 HREF="node10.html">2. Configuring Snort</A>
<B> Previous:</B> <A
 HREF="node10.html">2. Configuring Snort</A>
 &nbsp; <B>  <A ID="tex2html378"
  HREF="node1.html">Contents</A></B> </DIV>
<!--End of Navigation Panel-->

</BODY>
</HTML>
