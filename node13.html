<!DOCTYPE HTML>

<!--Converted with LaTeX2HTML 2021.2 (Released July 1, 2021) -->
<HTML lang="en">
<HEAD>
<TITLE>2.3 Performance Profiling</TITLE>
<META NAME="description" CONTENT="2.3 Performance Profiling">
<META NAME="keywords" CONTENT="snort_manual">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<META NAME="viewport" CONTENT="width=device-width, initial-scale=1.0">
<META NAME="Generator" CONTENT="LaTeX2HTML v2021.2">

<LINK REL="STYLESHEET" HREF="snort_manual.css">

<LINK REL="next" HREF="node14.html">
<LINK REL="previous" HREF="node12.html">
<LINK REL="next" HREF="node14.html">
</HEAD>

<BODY >

<DIV CLASS="navigation"><!--Navigation Panel-->
<A
 HREF="node14.html">
<IMG WIDTH="37" HEIGHT="24" ALT="next" SRC="next.png"></A> 
<A
 HREF="node10.html">
<IMG WIDTH="26" HEIGHT="24" ALT="up" SRC="up.png"></A> 
<A
 HREF="node12.html">
<IMG WIDTH="63" HEIGHT="24" ALT="previous" SRC="prev.png"></A> 
<A ID="tex2html455"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALT="contents" SRC="contents.png"></A>  
<BR>
<B> Next:</B> <A
 HREF="node14.html">2.4 Output Modules</A>
<B> Up:</B> <A
 HREF="node10.html">2. Configuring Snort</A>
<B> Previous:</B> <A
 HREF="node12.html">2.2 Event Thresholding</A>
 &nbsp; <B>  <A ID="tex2html456"
  HREF="node1.html">Contents</A></B> 
<BR>
<BR></DIV>
<!--End of Navigation Panel-->
<!--Table of Child-Links-->
<A ID="CHILD_LINKS"><STRONG>Subsections</STRONG></A>

<UL CLASS="ChildLinks">
<LI><A ID="tex2html457"
  HREF="node13.html#SECTION00331000000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">3</SPAN>.<SPAN CLASS="arabic">1</SPAN> Rule Profiling</A>
<UL>
<LI><A ID="tex2html458"
  HREF="node13.html#SECTION00331100000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">3</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">1</SPAN> Format</A>
<LI><A ID="tex2html459"
  HREF="node13.html#SECTION00331200000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">3</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">2</SPAN> Examples</A>
<LI><A ID="tex2html460"
  HREF="node13.html#SECTION00331300000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">3</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">3</SPAN> Output</A>
</UL>
<BR>
<LI><A ID="tex2html461"
  HREF="node13.html#SECTION00332000000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">3</SPAN>.<SPAN CLASS="arabic">2</SPAN> Preprocessor Profiling</A>
<UL>
<LI><A ID="tex2html462"
  HREF="node13.html#SECTION00332100000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">3</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN> Format</A>
<LI><A ID="tex2html463"
  HREF="node13.html#SECTION00332200000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">3</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN> Examples</A>
<LI><A ID="tex2html464"
  HREF="node13.html#SECTION00332300000000000000"><SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">3</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">3</SPAN> Output</A>
</UL></UL>
<!--End of Table of Child-Links-->
<HR>

<H1><A ID="SECTION00330000000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">3</SPAN> Performance Profiling</A>
</H1>

<P>
Snort can provide statistics on rule and preprocessor performance.  Each require only a
simple <SPAN  CLASS="texttt">config</SPAN> option to <SPAN  CLASS="texttt">snort.conf</SPAN> and Snort will print statistics on the worst (or all) performers
on exit.

<P>

<H2><A ID="SECTION00331000000000000000"></A><A ID="rule_profiling"></A>
<BR>
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">3</SPAN>.<SPAN CLASS="arabic">1</SPAN> Rule Profiling
</H2>

<P>

<H3><A ID="SECTION00331100000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">3</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">1</SPAN> Format</A>
</H3>
<SPAN  CLASS="texttt">config profile_rules: print [all | &lt;num&gt;], sort &lt;sort_option&gt;</SPAN>

<UL>
<LI><SPAN  CLASS="texttt">&lt;num&gt;</SPAN> is the number of rules to print
</LI>
<LI><SPAN  CLASS="texttt">&lt;sort_option&gt;</SPAN> is one of:
    <SPAN  CLASS="texttt">checks</SPAN>
    <SPAN  CLASS="texttt">matches</SPAN>
    <SPAN  CLASS="texttt">nomatches</SPAN>
    <SPAN  CLASS="texttt">avg_ticks</SPAN>
    <SPAN  CLASS="texttt">avg_ticks_per_match</SPAN>
    <SPAN  CLASS="texttt">avg_ticks_per_nomatch</SPAN>
    <SPAN  CLASS="texttt">total_ticks</SPAN>
</LI>
</UL>

<P>

<H3><A ID="SECTION00331200000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">3</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">2</SPAN> Examples</A>
</H3>

<UL>
<LI>Print all rules, sort by avg_ticks (default configuration if option is turned on)
<SPAN  CLASS="texttt">config profile_rules</SPAN>

<P>
</LI>
<LI>Print the top 10 rules, based on highest average time
<SPAN  CLASS="texttt">config profile_rules: print 10, sort avg_ticks</SPAN>

<P>
</LI>
<LI>Print all rules, sorted by number of checks
<SPAN  CLASS="texttt">config profile_rules: print all, sort checks</SPAN>

<P>
</LI>
<LI>Print top 100 rules, based on total time
<SPAN  CLASS="texttt">config profile_rules: print 100, sort total_ticks</SPAN>

<P>
</LI>
</UL>

<P>

<H3><A ID="SECTION00331300000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">3</SPAN>.<SPAN CLASS="arabic">1</SPAN>.<SPAN CLASS="arabic">3</SPAN> Output</A>
</H3>

<P>
Snort will print a table much like the following at exit.  

<DIV class="CENTER"><A ID="rule_profiling_example_output"></A><A ID="3234"></A>
<TABLE>
<CAPTION class="BOTTOM"><STRONG>Figure:</STRONG>
Rule Profiling Example Output</CAPTION>
<TR><TD><IMG
 STYLE="height: 20.60ex; " SRC="img21.svg"
 ALT="\begin{figure}\footnotesize {
\begin{verbatim}Rule Profile Statistics (worst 4...
...0.0 99.0
4 2580 1 29509 0 0 2660302 90.2 0.0 90.2\end{verbatim}
}\end{figure}"></TD></TR>
</TABLE>
</DIV>

<P>
Configuration line used to print the above table: 
<SPAN  CLASS="texttt">config profile_rules: print 4, sort total_ticks</SPAN>

<P>
The columns represent:

<UL>
<LI>Number (rank)
</LI>
<LI>Sig ID
</LI>
<LI>Generator ID
</LI>
<LI>Checks (number of times rule was evaludated after fast pattern match
  within portgroup or any-<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN>any rules)
</LI>
<LI>Matches (number of times ALL rule options matched, will be high for
  rules that have no options)
</LI>
<LI>Alerts (number of alerts generated from this rule)
</LI>
<LI>CPU Ticks 
</LI>
<LI>Avg Ticks per Check
</LI>
<LI>Avg Ticks per Match
</LI>
<LI>Avg Ticks per Nonmatch
</LI>
</UL>

<P>
Interpreting this info is the key.  The Microsecs (or Ticks) column is important
because that is the total time spent evaluating a given rule.  But,
if that rule is causing alerts, it makes sense to leave it alone.

<P>
A high Avg/Check is a poor performing rule, that most likely contains PCRE.
High Checks and low Avg/Check is usually an any-<SPAN CLASS="MATH"><IMG
 STYLE="height: 1.80ex; vertical-align: -0.21ex; " SRC="img2.svg"
 ALT="$&gt;$"></SPAN>any rule with few rule
options and no content.  Quick to check, the few options may or may not
match.  We are looking at moving some of these into code, especially
those with low SIDs.

<P>

<H2><A ID="SECTION00332000000000000000"></A><A ID="preproc_profiling"></A>
<BR>
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">3</SPAN>.<SPAN CLASS="arabic">2</SPAN> Preprocessor Profiling
</H2>

<P>

<H3><A ID="SECTION00332100000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">3</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">1</SPAN> Format</A>
</H3>
<SPAN  CLASS="texttt">config profile_preprocs: print [all | &lt;num&gt;], sort &lt;sort_option&gt;</SPAN>

<P>

<UL>
<LI><SPAN  CLASS="texttt">&lt;num&gt;</SPAN> is the number of preprocessors to print
</LI>
<LI><SPAN  CLASS="texttt">&lt;sort_option&gt;</SPAN> is one of:
<SPAN  CLASS="texttt">checks</SPAN>
<SPAN  CLASS="texttt">avg_ticks</SPAN>
<SPAN  CLASS="texttt">total_ticks</SPAN>
</LI>
</UL>

<P>

<H3><A ID="SECTION00332200000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">3</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">2</SPAN> Examples</A>
</H3>

<P>

<UL>
<LI>Print all preprocessors, sort by avg_ticks (default configuration if option is turned on)
<SPAN  CLASS="texttt">config profile_preprocs</SPAN>
</LI>
<LI>Print the top 10 preprocessors, based on highest average time
<SPAN  CLASS="texttt">config profile_preprocs: print 10, sort avg_ticks</SPAN>
</LI>
<LI>Print all preprocessors, sorted by number of checks
<SPAN  CLASS="texttt">config profile_preprocs: print all, sort checks</SPAN>
</LI>
</UL>

<P>

<H3><A ID="SECTION00332300000000000000">
<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">3</SPAN>.<SPAN CLASS="arabic">2</SPAN>.<SPAN CLASS="arabic">3</SPAN> Output</A>
</H3>

<P>
Snort will print a table much like the following at exit.

<DIV class="CENTER"><A ID="preprocessor_profiling_example_output"></A><A ID="3237"></A>
<TABLE>
<CAPTION class="BOTTOM"><STRONG>Figure:</STRONG>
Preprocessor Profiling Example Output</CAPTION>
<TR><TD><IMG
 STYLE="height: 44.78ex; " SRC="img22.svg"
 ALT="\begin{figure}\footnotesize {
\begin{verbatim}Preprocessor Profile Statistics ...
... total total 0 1018323 1018323 550830338 540.9 0.0\end{verbatim}
}\end{figure}"></TD></TR>
</TABLE>
</DIV>

<P>
Configuration line used to print the above table: 
<SPAN  CLASS="texttt">config profile_rules: print 3, sort total_ticks</SPAN>

<P>
The columns represent:

<UL>
<LI>Number (rank) - The number is indented for each layer.  Layer 1 preprocessors are
  listed under their respective caller (and sorted similarly).
</LI>
<LI>Preprocessor Name
</LI>
<LI>Layer - When printing a specific number of preprocessors all subtasks info
for a particular preprocessor is printed for each layer 0 preprocessor stat.
</LI>
<LI>Checks (number of times preprocessor decided to look at a packet,
  ports matched, app layer header was correct, etc)
</LI>
<LI>Exits  (number of corresponding exits &ndash; just to verify code is
  instrumented correctly, should ALWAYS match Checks, unless an
  exception was trapped)
</LI>
<LI>CPU Ticks
</LI>
<LI>Avg Ticks per Check
</LI>
<LI>Percent of caller - For non layer 0 preprocessors, i.e. subroutines within preprocessors,
  this identifies the percent of the caller's ticks that is spent for
  this subtask.
</LI>
</UL>

<P>
Because of task swapping, non-instrumented code, and other factors, the
Pct of Caller field will not add up to 100% of the caller's time.
It does give a reasonable indication of how much relative time is
spent within each subtask.

<P>

<DIV CLASS="navigation"><HR>
<!--Navigation Panel-->
<A
 HREF="node14.html">
<IMG WIDTH="37" HEIGHT="24" ALT="next" SRC="next.png"></A> 
<A
 HREF="node10.html">
<IMG WIDTH="26" HEIGHT="24" ALT="up" SRC="up.png"></A> 
<A
 HREF="node12.html">
<IMG WIDTH="63" HEIGHT="24" ALT="previous" SRC="prev.png"></A> 
<A ID="tex2html455"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALT="contents" SRC="contents.png"></A>  
<BR>
<B> Next:</B> <A
 HREF="node14.html">2.4 Output Modules</A>
<B> Up:</B> <A
 HREF="node10.html">2. Configuring Snort</A>
<B> Previous:</B> <A
 HREF="node12.html">2.2 Event Thresholding</A>
 &nbsp; <B>  <A ID="tex2html456"
  HREF="node1.html">Contents</A></B> </DIV>
<!--End of Navigation Panel-->

</BODY>
</HTML>
